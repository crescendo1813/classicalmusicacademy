<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescendo Classical Music Academy - Student Listening Portal</title>
    <meta name="description" content="389 music students listening to classical music education materials on standardized academy laptops in Ashburn, Virginia">
    <meta name="keywords" content="music academy, student portal, classical music, education, crescendo academy, ashburn virginia">
    <style>
        /* Alap st√≠lusok */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Login container */
        .login-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .login-title {
            font-size: 28px;
            margin-bottom: 10px;
            color: #ffd93d;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .login-subtitle {
            font-size: 16px;
            margin-bottom: 30px;
            color: #a5b4fc;
        }

        .music-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ffd93d;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Form elements */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #a5b4fc;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: #ffd93d;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #ffd93d;
            color: #333;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-btn:hover {
            background: #ffc107;
            transform: translateY(-2px);
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        /* Main content (hidden initially) */
        #main-content {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* St√≠lusok a f≈ë tartalomhoz */
        .main-body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: #111;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        h1 {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            text-align: center;
            color: #a5b4fc;
            margin-bottom: 20px;
            font-size: 16px;
        }

        /* Link szerkeszt≈ë st√≠lusok */
        .link-editor {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .editor-title {
            font-size: 18px;
            color: #ffd93d;
            font-weight: bold;
        }

        .editor-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .editor-btn {
            padding: 8px 15px;
            border: none;
            background: #222;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid #444;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .editor-btn:hover {
            background: #333;
            transform: translateY(-1px);
        }

        .editor-btn.add {
            border-color: #4CAF50;
            background: #2d5a2d;
        }

        .editor-btn.delete {
            border-color: #f44336;
            background: #5a2d2d;
        }

        .editor-btn.sort {
            border-color: #9C27B0;
            background: #4a2d5a;
        }

        .editor-btn.copy {
            border-color: #2196F3;
            background: #2d3e5a;
        }

        .editor-btn.csv {
            border-color: #FF9800;
            background: #5a472d;
        }

        .links-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
        }

        .link-item {
            display: flex;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            transition: background 0.2s;
        }

        .link-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .link-number {
            min-width: 30px;
            color: #a5b4fc;
            font-size: 12px;
        }

        .link-input {
            flex: 1;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: white;
            padding: 6px 10px;
            font-size: 14px;
            margin-right: 10px;
        }

        .link-input:focus {
            outline: none;
            border-color: #ffd93d;
        }

        .link-actions {
            display: flex;
            gap: 5px;
        }

        .link-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .link-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .link-btn.delete {
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .editor-status {
            text-align: center;
            font-size: 14px;
            color: #a5b4fc;
            margin-top: 10px;
        }

        /* CSV import/export st√≠lusok */
        .csv-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .csv-input {
            display: none;
        }

        .csv-label {
            padding: 8px 15px;
            background: #222;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid #444;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .csv-label:hover {
            background: #333;
            transform: translateY(-1px);
        }

        /* Minim√°lt vide√≥k s√°v */
        .minimized-bar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .minimized-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .minimized-videos {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .minimized-video {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .minimized-video:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .minimized-video.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .minimized-video.playing {
            border-color: #ffd93d;
            background: rgba(255, 217, 61, 0.1);
        }

        /* Gombok */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 0;
            background: rgba(17, 17, 17, 0.9);
            padding: 15px;
            z-index: 100;
            border-radius: 10px;
        }

        button {
            padding: 12px 20px;
            border: none;
            background: #222;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #444;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .start-btn {
            border-color: #4CAF50;
            background: #2d5a2d;
        }

        .stop-btn {
            border-color: #f44336;
            background: #5a2d2d;
        }

        .load-btn {
            border-color: #2196F3;
            background: #2d3c5a;
        }

        .graceful-btn {
            border-color: #FF9800;
            background: #5a472d;
        }

        /* Timer display */
        .timer-container {
            text-align: center;
            margin: 20px 0;
        }

        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #ffd93d;
            margin: 10px 0;
        }

        .timer-label {
            font-size: 16px;
            color: #a5b4fc;
        }

        /* Graceful shutdown timer */
        .graceful-timer {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #FF9800;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .graceful-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
        }

        .graceful-time {
            font-size: 24px;
            font-weight: bold;
            color: #FF9800;
            margin: 10px 0;
        }

        /* Batch progress */
        .batch-progress {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            overflow-x: auto;
        }

        .batch-step {
            text-align: center;
            flex: 1;
            padding: 10px;
            position: relative;
            min-width: 120px;
        }

        .batch-step.active {
            color: #ffd93d;
        }

        .batch-step.completed {
            color: #4CAF50;
        }

        .batch-step::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 0;
            width: 100%;
            height: 2px;
            background: #333;
            z-index: -1;
        }

        .batch-step:last-child::after {
            display: none;
        }

        .batch-step.active::after {
            background: #ffd93d;
        }

        .batch-step.completed::after {
            background: #4CAF50;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            font-size: 14px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 12px;
            color: #a5b4fc;
        }

        /* Rekl√°m statisztik√°k */
        .ad-stats {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-size: 14px;
        }

        .ad-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #ffd93d);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Status message */
        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 16px;
            border-left: 4px solid #ff6b6b;
        }

        /* Playback statistics */
        .playback-stats {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .playback-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .playback-info {
            font-size: 14px;
            color: #a5b4fc;
            text-align: center;
        }

        .tip {
            font-size: 12px;
            color: #666;
            margin-top: 20px;
            text-align: center;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            color: #ffd93d;
            margin: 20px 0;
            font-size: 14px;
        }

        /* √öj v√©delmi indik√°torok */
        .security-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .security-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid;
            font-size: 12px;
        }

        .security-card.safe {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .security-card.warning {
            border-color: #ff9800;
            background: rgba(255, 152, 0, 0.1);
        }

        .security-card.danger {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        .risk-monitor {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff6b6b;
        }

        .risk-level {
            height: 10px;
            background: linear-gradient(90deg, #4CAF50, #ff9800, #f44336);
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
        }

        .risk-indicator {
            position: absolute;
            top: -2px;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }

        /* Mem√≥ria monitor */
        .memory-monitor {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }

        .memory-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .memory-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .memory-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .memory-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .memory-label {
            font-size: 11px;
            color: #a5b4fc;
        }

        .memory-bar {
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .memory-usage {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #ff9800, #f44336);
            width: 0%;
            transition: width 0.5s ease;
        }

        .cleanup-alert {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
            font-size: 12px;
            display: none;
        }

        /* Stealth monitor */
        .stealth-monitor {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #9C27B0;
        }

        .stealth-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .stealth-metric {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .stealth-status {
            text-align: center;
            font-size: 14px;
            color: #a5b4fc;
            margin-top: 10px;
        }

        /* Vide√≥s player kont√©ner - WEBOLDAL R√âSZEK√âNT */
        .video-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
        }

        .video-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .video-player {
            background: #000;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
            border: 1px solid #444;
        }

        .video-player:hover {
            transform: translateY(-3px);
        }

        .player-container {
            width: 100%;
            height: 180px;
            background: #000;
            cursor: pointer;
            position: relative;
        }

        .video-info {
            padding: 8px;
            font-size: 10px;
            color: #a5b4fc;
            text-align: center;
        }

        .ad-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 193, 7, 0.9);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }

        .click-status {
            position: absolute;
            bottom: 25px;
            left: 5px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: bold;
        }

        /* √öj ablakkezel≈ë gombok */
        .window-controls {
            position: absolute;
            top: 5px;
            left: 5px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .window-btn {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .minimize-btn {
            background: rgba(255, 193, 7, 0.9);
            color: #000;
        }

        .minimize-btn:hover {
            background: rgba(255, 193, 7, 1);
        }

        .close-btn {
            background: rgba(244, 67, 54, 0.9);
            color: white;
        }

        .close-btn:hover {
            background: rgba(244, 67, 54, 1);
        }

        /* Popup ablak */
        .ad-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 600px;
            height: 70vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
        }

        .popup-header {
            background: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .popup-content {
            width: 100%;
            height: calc(100% - 50px);
            border: none;
            border-radius: 0 0 10px 10px;
        }

        .close-popup {
            background: #ff4444;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            display: none;
        }

        /* √öj debug st√≠lusok */
        .debug-panel {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .debug-title {
            color: #f44336;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .debug-info {
            color: #ff9800;
            margin: 5px 0;
        }
        
        .debug-error {
            color: #f44336;
            font-weight: bold;
        }
        
        .debug-success {
            color: #4CAF50;
        }
        
        .element-state {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 8px;
            z-index: 1000;
        }
        
        /* Batch bet√∂lt√©s gomb */
        .batch-controls {
            text-align: center;
            margin: 20px 0;
        }
        
        /* Fingerprint display */
        .fingerprint-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 12px;
            text-align: center;
        }

        /* Profi v√©delmi elemek */
        .advanced-protection {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #00BCD4;
        }

        .protection-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .protection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .protection-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
        }

        .protection-status {
            font-weight: bold;
            margin-top: 5px;
        }

        .protection-status.active {
            color: #4CAF50;
        }

        .protection-status.inactive {
            color: #f44336;
        }

        /* Traffic simulation */
        .traffic-simulation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #FF5722;
        }

        .traffic-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .traffic-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .traffic-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .traffic-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .traffic-label {
            font-size: 11px;
            color: #a5b4fc;
        }

        /* Firefox optimaliz√°l√°sok */
        .firefox-optimized {
            /* Firefox specifikus optimaliz√°ci√≥k */
            image-rendering: -moz-crisp-edges;
            scroll-behavior: smooth;
        }

        /* Performance monitor */
        .performance-monitor {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #FF5722;
        }

        .performance-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .performance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .performance-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .performance-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .performance-label {
            font-size: 11px;
            color: #a5b4fc;
        }

        /* √öj Error Monitoring panel */
        .error-monitor {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .error-title {
            color: #f44336;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .error-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .error-indicator {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid;
        }

        .error-indicator.safe {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .error-indicator.warning {
            border-color: #ff9800;
            background: rgba(255, 152, 0, 0.1);
        }

        .error-indicator.danger {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        .error-value {
            font-size: 16px;
            font-weight: bold;
            margin: 5px 0;
        }

        .error-label {
            font-size: 11px;
            color: #a5b4fc;
        }

        /* Hardware Simulation panel */
        .hardware-simulation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #FF5722;
        }

        .hardware-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .hardware-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .hardware-stat {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .hardware-value {
            font-size: 18px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .hardware-label {
            font-size: 11px;
            color: #a5b4fc;
        }

        /* Education Context Panel */
        .education-context {
            background: rgba(0, 150, 136, 0.1);
            border: 2px solid #009688;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .education-title {
            font-size: 16px;
            color: #ffd93d;
            margin-bottom: 10px;
            text-align: center;
        }

        .education-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .education-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
        }

        .education-value {
            font-size: 16px;
            font-weight: bold;
            color: #ffd93d;
            margin: 5px 0;
        }

        .education-label {
            font-size: 11px;
            color: #a5b4fc;
        }
    </style>
</head>
<body class="firefox-optimized">
    <!-- Popup ablak rekl√°mokhoz -->
    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="ad-popup" id="adPopup">
        <div class="popup-header">
            <span>Advertisement</span>
            <button class="close-popup" id="closePopup">Close</button>
        </div>
        <iframe class="popup-content" id="popupContent" src="about:blank"></iframe>
    </div>

    <!-- Login Section -->
    <div id="login-section" class="login-container">
        <div class="music-icon">üéµ</div>
        <h1 class="login-title">Crescendo Classical Music Academy</h1>
        <p class="login-subtitle">Student Listening Portal - Access for Academy Members Only</p>
        
        <form id="login-form">
            <div class="form-group">
                <label for="username">Student ID</label>
                <input type="text" id="username" placeholder="Enter your student ID" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>
            
            <button type="submit" class="login-btn">Login to Student Portal</button>
            
            <div id="error-message" class="error-message">
                Invalid credentials. Please try again.
            </div>
        </form>
    </div>

    <!-- Main Content (Hidden until login) -->
    <div id="main-content" class="main-body">
        <div id="am-experiment">
            <h1>üé¨ Crescendo Academy - Student Listening Portal</h1>
            <p class="subtitle">389 Music Students - Standardized Academy Laptops - Classical Music Curriculum - Ashburn, Virginia Campus</p>

            <!-- Education Context Panel -->
            <div class="education-context">
                <div class="education-title">üéì Educational Context - Classical Music Academy</div>
                <div class="education-info">
                    <div class="education-item">
                        <div class="education-value">389</div>
                        <div class="education-label">Music Students</div>
                    </div>
                    <div class="education-item">
                        <div class="education-value">Ashburn, VA</div>
                        <div class="education-label">Campus Location</div>
                    </div>
                    <div class="education-item">
                        <div class="education-value">Classical</div>
                        <div class="education-label">Music Curriculum</div>
                    </div>
                    <div class="education-item">
                        <div class="education-value">en-US</div>
                        <div class="education-label">Language</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #a5b4fc;">
                    üéµ Official student portal for classical music education - 389 students listening to curriculum materials in Ashburn, Virginia
                </div>
            </div>

            <!-- YouTube Link Szerkeszt≈ë -->
            <div class="link-editor">
                <div class="editor-header">
                    <div class="editor-title">üìù Classical Music Curriculum Editor</div>
                    <div class="editor-controls">
                        <button class="editor-btn add" id="addLinkBtn">Add Piece</button>
                        <button class="editor-btn delete" id="deleteAllBtn">Delete All</button>
                        <button class="editor-btn sort" id="sortLinksBtn">Sort</button>
                        <button class="editor-btn copy" id="copyLinksBtn">Copy</button>
                        <button class="editor-btn" id="pasteLinksBtn">Paste</button>
                        <button class="editor-btn" id="saveLinksBtn">Save</button>
                        <button class="editor-btn csv" id="exportCSVBtn">Export CSV</button>
                    </div>
                </div>
                <div class="links-container" id="linksContainer">
                    <!-- Link elemek ide ker√ºlnek -->
                </div>
                <div class="editor-status" id="editorStatus">
                    Total <span id="linkCount">0</span> classical music pieces in curriculum
                </div>
                <!-- CSV Import/Export vez√©rl≈ëk -->
                <div class="csv-controls">
                    <input type="file" id="csvImportInput" class="csv-input" accept=".csv">
                    <label for="csvImportInput" class="csv-label">üìÅ Import Curriculum</label>
                    <button class="editor-btn csv" id="importCSVBtn">üì§ Import CSV</button>
                </div>
            </div>

            <!-- Minim√°lt vide√≥k s√°v -->
            <div class="minimized-bar" id="minimizedBar" style="display: none;">
                <div class="minimized-title">üìã Minimized Listening Sessions - Click to Restore</div>
                <div class="minimized-videos" id="minimizedVideos">
                    <!-- Minim√°lt vide√≥k ide ker√ºlnek -->
                </div>
            </div>

            <!-- √öj Error Monitoring Panel -->
            <div class="error-monitor" id="errorMonitor">
                <div class="error-title">üö® YouTube Error & Rate Limit Monitor</div>
                <div class="error-status">
                    <div class="error-indicator safe" id="captchaStatus">
                        <div class="error-value">No CAPTCHA</div>
                        <div class="error-label">CAPTCHA Detection</div>
                    </div>
                    <div class="error-indicator safe" id="rateLimitStatus">
                        <div class="error-value">Normal</div>
                        <div class="error-label">Rate Limit Status</div>
                    </div>
                    <div class="error-indicator safe" id="requestStatus">
                        <div class="error-value">Stable</div>
                        <div class="error-label">Request Status</div>
                    </div>
                    <div class="error-indicator safe" id="sessionStatus">
                        <div class="error-value">Active</div>
                        <div class="error-label">Session Health</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #a5b4fc;">
                    ‚ö†Ô∏è Monitor only - Manual intervention required if issues detected
                </div>
            </div>

            <!-- √öj Hardware Simulation Panel -->
            <div class="hardware-simulation">
                <div class="hardware-title">‚öôÔ∏è Academy Hardware & Network</div>
                <div class="hardware-stats">
                    <div class="hardware-stat">
                        <div class="hardware-value" id="cpuUsage">15%</div>
                        <div class="hardware-label">CPU Usage</div>
                    </div>
                    <div class="hardware-stat">
                        <div class="hardware-value" id="memoryUsageSim">24%</div>
                        <div class="hardware-label">Memory Usage</div>
                    </div>
                    <div class="hardware-stat">
                        <div class="hardware-value" id="networkLatency">42ms</div>
                        <div class="hardware-label">Network Latency</div>
                    </div>
                    <div class="hardware-stat">
                        <div class="hardware-value" id="fingerprintRotation">5</div>
                        <div class="hardware-label">Fingerprint Rotations</div>
                    </div>
                </div>
            </div>

            <!-- Performance Monitor -->
            <div class="performance-monitor">
                <div class="performance-title">‚ö° Academy Performance Monitor</div>
                <div class="performance-stats">
                    <div class="performance-stat">
                        <div class="performance-value" id="fpsCounter">60 FPS</div>
                        <div class="performance-label">Frame Rate</div>
                    </div>
                    <div class="performance-stat">
                        <div class="performance-value" id="loadTime">0ms</div>
                        <div class="performance-label">Load Time</div>
                    </div>
                    <div class="performance-stat">
                        <div class="performance-value" id="playerStability">100%</div>
                        <div class="performance-label">Stability</div>
                    </div>
                    <div class="performance-stat">
                        <div class="performance-value" id="firefoxVersion">Firefox</div>
                        <div class="performance-label">Browser</div>
                    </div>
                </div>
            </div>

            <!-- Rekl√°m statisztik√°k FEL√úL -->
            <div class="ad-stats">
                <div class="ad-title">üìä Advertisement Statistics</div>
                <div>Total ads: <span id="totalAds">0</span> | Successful ads: <span id="successfulAds">0</span></div>
                <div>Estimated ad revenue: $<span id="adRevenue">0.00</span></div>
            </div>

            <!-- V√©delmi indik√°torok -->
            <div class="security-indicators">
                <div class="security-card safe" id="patternCard">
                    <div>üéØ Academy Pattern</div>
                    <div>Educational Use</div>
                </div>
                <div class="security-card safe" id="timingCard">
                    <div>‚è±Ô∏è Timing</div>
                    <div>Class Schedule</div>
                </div>
                <div class="security-card safe" id="behaviorCard">
                    <div>üë§ Behavior</div>
                    <div>Student Listening</div>
                </div>
                <div class="security-card safe" id="riskCard">
                    <div>üõ°Ô∏è Risk</div>
                    <div>Very Low</div>
                </div>
            </div>

            <!-- DEBUG PANEL -->
            <div class="debug-panel">
                <div class="debug-title">üîç ACADEMY DEBUG PANEL - Educational Context</div>
                <div class="debug-info" id="debugClickStatus">Context: Music Academy - 389 Students</div>
                <div class="debug-info" id="debugElementState">Location: Ashburn, Virginia Campus</div>
                <div class="debug-info" id="debugEventStatus">Purpose: Classical Music Education</div>
                <div class="debug-info" id="debugFrameStatus">Curriculum: Official Materials</div>
                <div class="debug-info" id="debugTimingStatus">Language: en-US</div>
            </div>

            <!-- Graci√°lis le√°ll√°s timer -->
            <div class="graceful-timer" id="gracefulTimer">
                <div class="graceful-title">üïê Graceful Shutdown Active</div>
                <div class="graceful-time" id="gracefulTime">--:--</div>
                <div id="gracefulStatus">Listening sessions are gradually stopping...</div>
            </div>

            <!-- Profi v√©delmi elemek -->
            <div class="advanced-protection">
                <div class="protection-title">üõ°Ô∏è Academy Protection System</div>
                <div class="protection-grid">
                    <div class="protection-item">
                        <div>üåê Academy Network</div>
                        <div class="protection-status active" id="ipRotationStatus">Ashburn, VA</div>
                    </div>
                    <div class="protection-item">
                        <div>üîí Educational Traffic</div>
                        <div class="protection-status active" id="trafficEncryptionStatus">Ashburn Network</div>
                    </div>
                    <div class="protection-item">
                        <div>üîÑ Student Devices</div>
                        <div class="protection-status active" id="userAgentStatus">Standard Laptop</div>
                    </div>
                    <div class="protection-item">
                        <div>üì± Device Standard</div>
                        <div class="protection-status active" id="deviceSimulationStatus">Academy Model</div>
                    </div>
                    <div class="protection-item">
                        <div>üåç Academy Location</div>
                        <div class="protection-status active" id="geolocationStatus">Ashburn, VA Fixed</div>
                    </div>
                    <div class="protection-item">
                        <div>‚è∞ Class Schedule</div>
                        <div class="protection-status active" id="timezoneStatus">Academic Hours</div>
                    </div>
                    <div class="protection-item">
                        <div>üé≠ Student Fingerprint</div>
                        <div class="protection-status active" id="canvasSpoofingStatus">Ashburn Mode</div>
                    </div>
                    <div class="protection-item">
                        <div>üîç Educational Use</div>
                        <div class="protection-status active" id="webrtcStatus">Academic Context</div>
                    </div>
                </div>
            </div>

            <!-- Forgalom szimul√°ci√≥ -->
            <div class="traffic-simulation">
                <div class="traffic-title">üåê Academy Traffic - 389 Students</div>
                <div class="traffic-stats">
                    <div class="traffic-stat">
                        <div class="traffic-value" id="currentIP">104.16.56.123</div>
                        <div class="traffic-label">Ashburn Network</div>
                    </div>
                    <div class="traffic-stat">
                        <div class="traffic-value" id="requestCount">0</div>
                        <div class="traffic-label">Requests</div>
                    </div>
                    <div class="traffic-stat">
                        <div class="traffic-value" id="sessionTime">00:00</div>
                        <div class="traffic-label">Session</div>
                    </div>
                    <div class="traffic-stat">
                        <div class="traffic-value" id="fingerprintCount">0</div>
                        <div class="traffic-label">Fingerprints</div>
                    </div>
                </div>
            </div>

            <!-- Kock√°zat monitor -->
            <div class="risk-monitor">
                <div style="text-align: center; color: #ffd93d; margin-bottom: 10px;">
                    üéõÔ∏è Academy Performance Monitor - Educational Context
                </div>
                <div class="risk-level">
                    <div class="risk-indicator" id="riskIndicator" style="left: 5%;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #a5b4fc;">
                    <span>Optimal</span>
                    <span>Stable</span>
                    <span>Critical</span>
                </div>
                <div id="riskStatus" style="text-align: center; margin-top: 10px; font-size: 14px;">
                    ‚úÖ Educational Context Active - 389 Students - Standard Laptops - Classical Curriculum - Ashburn, VA Campus
                </div>
            </div>

            <!-- Mem√≥ria Monitor -->
            <div class="memory-monitor">
                <div class="memory-title">üß† Academy Memory Monitor - Manual Cleanup Only</div>
                <div class="memory-info">
                    <div class="memory-stat">
                        <div class="memory-value" id="memoryUsage">0 MB</div>
                        <div class="memory-label">Usage</div>
                    </div>
                    <div class="memory-stat">
                        <div class="memory-value" id="memoryLimit">0 MB</div>
                        <div class="memory-label">Limit</div>
                    </div>
                    <div class="memory-stat">
                        <div class="memory-value" id="memoryPercent">0%</div>
                        <div class="memory-label">Utilization</div>
                    </div>
                    <div class="memory-stat">
                        <div class="memory-value" id="cleanupCount">0</div>
                        <div class="memory-label">Cleanups</div>
                    </div>
                </div>
                <div class="memory-bar">
                    <div class="memory-usage" id="memoryBar"></div>
                </div>
                <div class="cleanup-alert" id="cleanupAlert">
                    üö® High memory usage! Manual cleanup recommended...
                </div>
                <div style="text-align: center; font-size: 12px; color: #a5b4fc; margin-top: 10px;">
                    ‚ö° Manual cleanup only - click below when needed
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <button id="manualCleanup" style="padding: 10px 20px; font-size: 14px; font-weight: bold;">üßπ Manual Memory Cleanup</button>
                </div>
            </div>

            <!-- Stealth Monitor -->
            <div class="stealth-monitor">
                <div style="text-align: center; color: #ffd93d; margin-bottom: 10px;">
                    üïµÔ∏è‚Äç‚ôÇÔ∏è Academy Context Monitor - Educational Use
                </div>
                <div class="stealth-metrics">
                    <div class="stealth-metric">
                        <span>Context:</span>
                        <span id="currentStrategy">music_academy</span>
                    </div>
                    <div class="stealth-metric">
                        <span>Student Count:</span>
                        <span id="currentUA">389</span>
                    </div>
                    <div class="stealth-metric">
                        <span>Location:</span>
                        <span id="currentTZ">Ashburn, VA</span>
                    </div>
                    <div class="stealth-metric">
                        <span>Device Standard:</span>
                        <span id="currentProfile">Academy Laptop</span>
                    </div>
                </div>
                <div class="stealth-status" id="stealthStatus">
                    ‚úÖ Educational Context Active - 389 Students - Standard Laptops - Classical Curriculum - Ashburn, VA Campus
                </div>
            </div>

            <!-- F≈ë vez√©rl≈ëk -->
            <div class="controls">
                <button class="load-btn" id="loadBatchButton">
                    üì• Load Curriculum
                </button>
                <button class="graceful-btn" id="gracefulShutdownButton">
                    üïê Graceful Shutdown (0-1 minutes)
                </button>
                <button class="stop-btn" id="stopButton">
                    ‚èπÔ∏è Stop All
                </button>
                <button class="load-btn" id="nextBatchButton">
                    üîÑ Load Next Session
                </button>
            </div>

            <!-- Timer -->
            <div class="timer-container">
                <div class="timer" id="timer">--:--</div>
                <div class="timer-label" id="timerLabel">Music Academy Mode - 389 Students - Classical Curriculum - Ashburn, VA Campus</div>
            </div>

            <!-- Batch progress -->
            <div class="batch-progress" id="batchProgressContainer">
                <!-- Dinamikusan gener√°l√≥dik -->
            </div>

            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="readyCount">0</div>
                    <div class="stat-label">Loaded Players</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeCount">0</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalCount">389</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentBatch">-</div>
                    <div class="stat-label">Active Session</div>
                </div>
            </div>

            <!-- Progress bar -->
            <div class="progress-container">
                <div class="progress-bar" id="loadProgress"></div>
            </div>

            <!-- Playback statistics -->
            <div class="playback-stats">
                <div class="playback-title">üìä Academy Listening Statistics</div>
                <div class="playback-info">
                    <div id="playbackCount">Total listening sessions: 0</div>
                    <div id="monthlyStats">Monthly breakdown:</div>
                </div>
            </div>

            <!-- Ujjlenyomat inform√°ci√≥k -->
            <div class="fingerprint-info" id="fingerprintInfo">
                Academy educational fingerprint - 389 Students - Standard Laptops - Classical Curriculum - Ashburn, Virginia Campus
            </div>

            <!-- Status √ºzenet -->
            <div class="status" id="statusMessage">
                Crescendo Academy Student Portal - 389 Students - Classical Music Curriculum - Ashburn, Virginia Campus - Click "Load Curriculum" to start listening sessions!
            </div>

            <!-- Loading -->
            <div class="loading" id="loadingMessage" style="display: none;">
                Loading curriculum materials for 389 students...
            </div>

            <!-- Vide√≥s Player Kont√©ner - INTEGR√ÅLT A WEBOLDALBA -->
            <div class="video-container">
                <div class="video-title">üé¨ Student Listening Sessions - Classical Music Curriculum</div>
                <div class="video-grid" id="videoGrid">
                    <!-- Vide√≥k ide ker√ºlnek dinamikusan -->
                </div>
            </div>

            <p class="tip">
                ‚úÖ 389 students in dynamic sessions (95-100 students/session) - EDUCATIONAL USE<br>
                üéµ Classical Music Academy - Official Curriculum Materials<br>
                üíª Standardized Academy Laptops - Same Hardware Model<br>
                üéì Daily Listening Sessions - 1 Piece Per Student<br>
                üñ±Ô∏è Manual start - every student must start their session manually<br>
                üåê Academy Network - Ashburn, Virginia IP Range<br>
                üìö Educational Context - Classical Music Curriculum<br>
                üßë‚Äçüéì Student ID: 389 Registered Students<br>
                üè´ Institution: Crescendo Classical Music Academy<br>
                üìç Location: Ashburn, Virginia Campus<br>
                üéº Purpose: Music Education & Appreciation<br>
                üìÖ Schedule: Daily Listening Practice<br>
                üí∞ Ad revenue tracking - supports academy programs<br>
                üõ°Ô∏è Behavior Monitor - educational use verification<br>
                üß† Memory Monitor - MANUAL CLEANUP ONLY (no automatic cleanup)<br>
                üïµÔ∏è‚Äç‚ôÇÔ∏è Advanced Educational Context - verified academic use<br>
                üìä Statistics - tracking listening sessions<br>
                üîÄ Curriculum pieces randomly shuffled after each cycle<br>
                üåê Academy fingerprint context<br>
                üîç Advanced diagnostic system - Real-time monitoring<br>
                üïê New: Graceful shutdown - 0-1 minute countdown<br>
                üîë New: Academy fingerprint generation for each student<br>
                üõ°Ô∏è New: Academy Protection System - Ashburn network, educational traffic<br>
                üåç New: Ashburn location context, campus timezone<br>
                üì± New: Standardized device simulation<br>
                üîí New: Educational use verification, academic context<br>
                ü™ü New: Ad click popup windows<br>
                üì∫ New: Larger player size for better visibility<br>
                üîÑ FIXED: Listening sessions continue after ads<br>
                ü¶ä FIXED: Academy laptop state tracking - proper progress display<br>
                ‚ö° FIXED: Ashburn network performance optimization<br>
                üö´ REMOVED: Automatic memory cleanup - only manual cleanup available<br>
                üéØ NEW: All curriculum materials load and play in optimal quality<br>
                ‚úèÔ∏è NEW: Curriculum Editor for easy material management<br>
                üìÅ NEW: CSV Import/Export for curriculum management<br>
                ü™ü NEW: Minimize and Close buttons for each session - reduce CPU usage<br>
                üìã NEW: Minimized sessions bar - restore minimized sessions easily<br>
                üîÑ FIXED: Listening sessions continue when minimized (not paused)<br>
                üö® NEW: YouTube Error & Rate Limit Monitor - CAPTCHA detection<br>
                ‚öôÔ∏è NEW: Academy Hardware & Network Simulation - CPU/Memory usage simulation<br>
                üîÑ NEW: Fingerprint rotation & educational context improvements
            </p>
        </div>
    </div>

    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
        // ========== BEL√âP√âSI RENDSZER ==========
        const VALID_USERNAME = "Zonebooster";
        const VALID_PASSWORD = "Newmate@1989";
        
        // Bel√©p√©s ellen≈ërz√©se
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('error-message');
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                // Sikeres bel√©p√©s
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                document.body.className = 'main-body';
                
                // Firefox detekt√°l√°s
                detectFirefox();
                
                // Alkalmazza az oktat√°si kontextust
                EducationContext.applyEducationalContext();
            } else {
                // Sikertelen bel√©p√©s
                errorMessage.style.display = 'block';
                document.getElementById('password').value = '';
            }
        });

        // ========== OKTAT√ÅSI KONTEXTUS MODUL - ASHBURN, VIRGINIA ==========
        const EducationContext = {
            institution: "Crescendo Classical Music Academy",
            studentCount: 389,
            course: "Classical Music Mastery",
            deviceModel: "Academy_Laptop_Model_X_2024",
            purpose: "educational_listening",
            curriculum: "classical_music",
            location: "Ashburn, Virginia",
            language: "en-US",
            timezone: "America/New_York",
            
            applyEducationalContext() {
                // 1. Page meta adatok
                this.setPageMetadata();
                
                // 2. Referer spoofing
                this.spoofReferer();
                
                // 3. Custom headers
                this.addEducationalHeaders();
                
                // 4. URL param√©terek
                this.addURLParameters();
                
                // 5. LocalStorage kontextus
                this.setLocalStorageContext();
                
                console.log('üéì Educational context applied: Music Academy Mode - 389 Students - Ashburn, Virginia');
            },
            
            setPageMetadata() {
                document.title = `${this.institution} - Student Listening Portal`;
                let metaDesc = document.querySelector('meta[name="description"]');
                if (!metaDesc) {
                    metaDesc = document.createElement('meta');
                    metaDesc.name = 'description';
                    document.head.appendChild(metaDesc);
                }
                metaDesc.content = `${this.studentCount} music students listening to ${this.course} curriculum on standardized academy laptops in ${this.location}`;
                
                // Viewport meta
                let viewport = document.querySelector('meta[name="viewport"]');
                if (!viewport) {
                    viewport = document.createElement('meta');
                    viewport.name = 'viewport';
                    viewport.content = 'width=device-width, initial-scale=1.0';
                    document.head.appendChild(viewport);
                }
            },
            
            spoofReferer() {
                Object.defineProperty(document, 'referrer', {
                    value: `https://crescendo1813.github.io/classicalmusicacademy/student-dashboard`,
                    configurable: true
                });
                
                // History state manipulation
                history.replaceState({}, `${this.institution} Portal`, '/classicalmusicacademy/student-listening');
            },
            
            addEducationalHeaders() {
                const originalFetch = window.fetch;
                window.fetch = function(...args) {
                    if (args[0] && typeof args[0] === 'string' && args[0].includes('youtube.com')) {
                        const options = args[1] || {};
                        options.headers = {
                            ...options.headers,
                            'X-Education-Institution': 'Crescendo Classical Music Academy',
                            'X-Student-Count': '389',
                            'X-Course-Material': 'Classical Music Curriculum',
                            'X-Device-Standard': 'Academy Laptop Model X',
                            'X-Purpose': 'Educational Listening',
                            'X-Location': 'Ashburn, Virginia',
                            'X-Language': 'en-US',
                            'Referer': 'https://crescendo1813.github.io/classicalmusicacademy/'
                        };
                        args[1] = options;
                    }
                    return originalFetch.apply(this, args);
                };
                
                // XMLHttpRequest header manipul√°ci√≥
                const originalXHROpen = XMLHttpRequest.prototype.open;
                XMLHttpRequest.prototype.open = function(method, url, ...rest) {
                    if (url.includes('youtube.com')) {
                        this.addEventListener('loadstart', function() {
                            this.setRequestHeader('X-Education-Institution', 'Crescendo Classical Music Academy');
                            this.setRequestHeader('X-Student-Count', '389');
                            this.setRequestHeader('X-Course-Material', 'Classical Music Curriculum');
                            this.setRequestHeader('X-Location', 'Ashburn, Virginia');
                        });
                    }
                    return originalXHROpen.call(this, method, url, ...rest);
                };
            },
            
            addURLParameters() {
                // Educational UTM param√©terek
                this.educationalParams = new URLSearchParams({
                    context: 'music_education',
                    institution: 'crescendo_classical_academy',
                    student_count: '389',
                    device: 'academy_standard_laptop',
                    course: 'classical_music',
                    purpose: 'educational_listening',
                    location: 'ashburn_virginia',
                    language: 'en-US',
                    utm_source: 'crescendo_academy',
                    utm_medium: 'student_portal',
                    utm_campaign: 'music_education_2024',
                    utm_content: 'classical_curriculum'
                });
                
                // YouTube IFrame API educational context
                this.patchYouTubeAPI();
            },
            
            patchYouTubeAPI() {
                // YouTube IFrame API educational context patch
                const originalCreateElement = document.createElement;
                document.createElement = function(tagName) {
                    const element = originalCreateElement.call(this, tagName);
                    if (tagName.toLowerCase() === 'iframe' && element.src.includes('youtube.com')) {
                        const url = new URL(element.src);
                        this.educationalParams.forEach((value, key) => {
                            url.searchParams.set(key, value);
                        });
                        element.src = url.toString();
                    }
                    return element;
                }.bind(this);
            },
            
            setLocalStorageContext() {
                localStorage.setItem('institution', this.institution);
                localStorage.setItem('student_count', this.studentCount.toString());
                localStorage.setItem('device_type', this.deviceModel);
                localStorage.setItem('course', this.course);
                localStorage.setItem('purpose', this.purpose);
                localStorage.setItem('curriculum', this.curriculum);
                localStorage.setItem('location', this.location);
                localStorage.setItem('language', this.language);
                localStorage.setItem('timezone', this.timezone);
            },
            
            getEducationalVideoUrl(videoId) {
                const baseUrl = `https://www.youtube.com/watch?v=${videoId}`;
                const url = new URL(baseUrl);
                this.educationalParams.forEach((value, key) => {
                    url.searchParams.set(key, value);
                });
                return url.toString();
            }
        };

        // ========== FIREFOX OPTIMALIZ√ÅL√ÅS ==========
        function detectFirefox() {
            const isFirefox = typeof InstallTrigger !== 'undefined';
            if (isFirefox) {
                document.getElementById('firefoxVersion').textContent = 'Firefox OK';
                console.log('ü¶ä Firefox detected - applying optimizations');
                
                // Alkalmaz Firefox optimaliz√°ci√≥kat
                applyFirefoxOptimizations();
            } else {
                document.getElementById('firefoxVersion').textContent = 'Other Browser';
                console.log('‚ö†Ô∏è Non-Firefox browser - limited optimizations');
            }
        }

        function applyFirefoxOptimizations() {
            // Firefox specifikus optimaliz√°ci√≥k
            document.body.classList.add('firefox-optimized');
            
            // Batch m√©ret Firefoxhoz - 95-100
            MANUAL_CONTROL_CONFIG.BATCH.MIN_SIZE = 95;
            MANUAL_CONTROL_CONFIG.BATCH.MAX_SIZE = 100;
            
            // T√∂bb id≈ë a bet√∂lt√©shez
            FIREFOX_CONFIG.BATCH_LOAD_DELAY = 300;
            
            // Mem√≥ria monitoroz√°s bekapcsolva, de automatikus tiszt√≠t√°s ki
            MEMORY_CONFIG.MONITOR_INTERVAL = 2000;
            
            // Friss√≠ts√ºk a fel√ºletet
            document.getElementById('statusMessage').innerHTML = 
                'üéì Crescendo Academy Student Portal Active! 389 Students - Classical Music Curriculum - Standard Academy Laptops - Ashburn, Virginia Campus.';
                
            console.log('‚úÖ Firefox optimizations applied');
        }

        // ========== FIREFOX KONFIGUR√ÅCI√ì ==========
        const FIREFOX_CONFIG = {
            BATCH_LOAD_DELAY: 300, // Firefoxhoz t√∂bb id≈ë
            VIDEO_BUFFER_SIZE: 5,  // Kevesebb vide√≥ egyszerre
            PERFORMANCE_MONITOR: true
        };

        // ========== MANU√ÅLIS VEZ√âRL√âS KONFIGUR√ÅCI√ì ==========
        const MANUAL_CONTROL_CONFIG = {
            // Batch m√©ret v√©letlenszer≈±s√©g - FIREFOX OPTIMALIZ√ÅLT
            BATCH: {
                MIN_SIZE: 95,   // 95-100-as batch m√©ret
                MAX_SIZE: 100,  // 95-100-as batch m√©ret
                TARGET_TOTAL: 389
            },
            // Graci√°lis le√°ll√°s id≈ëtartam - 0-1 perc
            GRACEFUL_SHUTDOWN: {
                MIN_DURATION: 0 * 60 * 1000, // 0 perc
                MAX_DURATION: 1 * 60 * 1000  // 1 perc
            }
        };

        // Mem√≥ria konfigur√°ci√≥ - MANU√ÅLIS TISZT√çT√ÅS CSAK
        const MEMORY_CONFIG = {
            MONITOR_INTERVAL: 2000,  // 2 m√°sodperc - mem√≥ria ellen≈ërz√©s
        };

        // Profi v√©delmi konfigur√°ci√≥
        const ADVANCED_PROTECTION_CONFIG = {
            IP_ROTATION_INTERVAL: 30000, // 30 m√°sodperc
            USER_AGENT_ROTATION_INTERVAL: 45000, // 45 m√°sodperc
            TRAFFIC_SIMULATION_INTERVAL: 15000, // 15 m√°sodperc
            FINGERPRINT_ROTATION_INTERVAL: 60000 // 60 m√°sodperc
        };

        // √öj Error Monitoring konfigur√°ci√≥
        const ERROR_MONITOR_CONFIG = {
            CHECK_INTERVAL: 5000, // 5 m√°sodpercenk√©nt ellen≈ëriz
            CAPTCHA_DETECTION: true,
            RATE_LIMIT_DETECTION: true,
            REQUEST_MONITORING: true
        };

        // √öj Hardware Simulation konfigur√°ci√≥
        const HARDWARE_SIMULATION_CONFIG = {
            CPU_USAGE_RANGE: { min: 10, max: 40 }, // CPU haszn√°lat %
            MEMORY_USAGE_RANGE: { min: 15, max: 35 }, // Mem√≥ria haszn√°lat %
            NETWORK_LATENCY_RANGE: { min: 20, max: 100 }, // H√°l√≥zati k√©sleltet√©s ms
            UPDATE_INTERVAL: 3000 // 3 m√°sodpercenk√©nt friss√≠t
        };

        // Rekl√°m weboldalak list√°ja
        const AD_WEBSITES = [
            "https://www.amazon.com",
            "https://www.ebay.com",
            "https://www.walmart.com",
            "https://www.bestbuy.com",
            "https://www.target.com",
            "https://www.apple.com",
            "https://www.microsoft.com",
            "https://www.cnn.com",
            "https://www.foxnews.com",
            "https://www.nytimes.com"
        ];

        // ========== ASHBURN, VIRGINIA IP C√çMEK ==========
        const ASHBURN_IPS = [
            "104.16.56.123", "104.16.57.123", "104.16.58.123", "104.16.59.123",
            "104.16.60.123", "104.16.61.123", "104.16.62.123", "104.16.63.123",
            "104.17.56.123", "104.17.57.123", "104.17.58.123", "104.17.59.123",
            "104.17.60.123", "104.17.61.123", "104.17.62.123", "104.17.63.123",
            "104.18.56.123", "104.18.57.123", "104.18.58.123", "104.18.59.123",
            "104.19.56.123", "104.19.57.123", "104.19.58.123", "104.19.59.123",
            "172.64.56.123", "172.64.57.123", "172.64.58.123", "172.64.59.123",
            "172.65.56.123", "172.65.57.123", "172.65.58.123", "172.65.59.123"
        ];

        // ========== ASHBURN, VIRGINIA ACADEMY USER AGENTS ==========
        const ASHBURN_USER_AGENTS = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0',
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36',
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:120.0) Gecko/20100101 Firefox/120.0',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
        ];

        // √ñsszes YouTube video ID - 389 klasszikus zenei darab!
        let allYouTubeLinks = [
            "cMp-R_FqtQA", "aZgSNIe6cBY", "bOopMi29kRY", "tYuYJ1hIsi8", "4-WtHjXLNCo",
            "-uhGPF_cgOk", "kWDoWMdbGMA", "ZVWzoHpir5U", "orylSDsIgnI", "wn73hwpvW8A",
            "l9pltc3Hb9I", "hCZLWDi2IR8", "cwOHVbr7Vkc", "BvHsut1cDYk", "pzp6QRNMeXE",
            "AVZjk1IO1nM", "Czg-kJ0bi7U", "F3hjmIFCIis", "TTEP3yTfN3E", "UWIVJzuN640",
            "6_bL4LYsap8", "VEpxpFGuCzc", "rWKMZRJw9Co", "OIKfpX9MOUw", "VzNrZ-62n7E",
            "f8BCZZl6Vzw", "6bT_V7GV2t4", "YrUiKHPuHwI", "bcQypBjDoYY", "6a8_VRHJByQ",
            "nB-GkX4Bjr8", "8CMER1ePJ3E", "TfwdiIKHsuA", "mXD8IEpOi3Y", "KBY-LTyNtUo",
            "UTiYkI2MkJs", "1v6lzdZajrc", "xbEAO9qyU9A", "qH5kYkXbjGM", "OcCyAFWm4fA",
            "PKXWWamkWns", "wfa75c14lLM", "7HragoeZlOA", "jOD9SMgq9-c", "fZCExIFptRg",
            "qfWPq0U_2jM", "vnGMYPNxIN8", "-TNgmGmN0Ak", "smUEglbjtqM", "nZl84m9n6Gk",
            "E4-lYY-DPkw", "8GxdKF15a6k", "L-gwG1wZLDQ", "pvnL2LSabeg", "3fFB3dhajLM",
            "zvZrZ76aBnY", "ShkG6Ph2oiE", "3dl7fSt2oCA", "rSxwTDNwdQs", "Twfx_0KXmjY",
            "l8y9-J7WCwg", "xLF3inAjywY", "W-QW_w3vPO0", "aV78cB-YKdM", "kua-4tBkvfM",
            "iUWLkoPFqgc", "9TVFHnk5hlA", "fPz9CctBNOs", "v3HDlcXnPpg", "hHDB_gTuCOc",
            "epi-kCVvNSo", "alVH5TBswfA", "8fzcEY2JjyQ", "f1AUwkaBJXE", "W-PvCCMijMs",
            "ppJmqLHXSQI", "4xuAWpUtmq0", "Ot7vtGtTM-I", "F_6GiGlsOBI", "ot9Bilqh6lA",
            "Plfh8_bcdIY", "MUtUxi1L2jLg", "qLD50U4kIJQ", "kfLNXrYzRio", "Ckl-9Cp_F6I",
            "IleqlrxKbac", "ia43xYLjEx8", "ULsVGPcBEAw", "6GZ39I1WgX4", "n9aHRHX0Jwo",
            "nVYF-WJE6to", "R8YcpZ-klGM", "jpEbpRzMZS0", "CzJgrJhfvJA", "BJOKOxwZ8hQ",
            "7JJ_NOmnTNI", "xeXUl0ZGfek", "1PrTEj-czks", "nYl9il7yTXM", "fC0cIXaDQdk",
            "U26VU5Bq7gk", "xk6aEaZ-mrU", "UkoJCiNSwEs", "Pg8qP1s8Gpg", "5MxuWu1hsyM",
            "4DaZRhtX7ts", "wOzT4ICTdco", "kkylvlj19a0", "Ca-FRketiu4", "edjjza1Y7x4",
            "U3yTAJ65cL0", "tHryixWXpBs", "eOnVbSrztWA", "MGH7AFeLACU", "n8DPv_yBLtM",
            "uSEpqSwrc1M", "AL9MvIHB2uE", "8ILwT6Gnr_I", "ce1VElw5KRA", "_rCRLWI7uUo",
            "FKpruWSbVsU", "7raYc91KZPM", "cz5pPNaVu-A", "miQhliUeR-4", "j-ph59b0mrc",
            "ENBk4K758Dg", "vmqV2tvgTWo", "T2OqXKZFPgs", "G_ApRDmrT-Y", "eWRAaYNtvvQ",
            "aQkOJM-zBC4", "Iwe6P8aMhW4", "ymHm_38NOaY", "E1IB3QPnXeA", "aUPqrJqrZPk",
            "UhsN-0Z8Has", "Cq-QPIhqPkw", "ZWM_OPb11ZY", "MWJ9bdu8qUM", "_eJ1TirnY7g",
            "V4jJhIbQBI8", "ebPXXmEO7mo", "HSRDp4-MLwY", "q2NiGxkMKSU", "9t_nPX-jDVk",
            "xIeh_KOmAEs", "vNfpqoZL1p4", "nB8UiZYmUR0", "P_RFdkMLNt8", "KSjTDGYeyjk",
            "bprGVaExyO8", "qZAOYVUf0Vg", "Z-jW7u0ZSkI", "BRNcjrv2VtE", "SutVma3u32E",
            "WUt_8NWLOik", "3L5sV8vncmg", "PKl82l6Dt3w", "w3rGzFxCWgw", "qYaGwpp8w_0",
            "8E3IBzQO7jo", "w-2_5BXUUqI", "d_YAD8dSDzw", "NVkO1_HE6iE", "-OK4AlPcoJs",
            "CI0PRetRoE0", "X9zo5S1hLhE", "GAGtZysIsw8", "vNqlAEZy3IE", "5V_2MqMyPow",
            "J8vu_NW4sdw", "wGXbZDnG9oc", "IOOYwxxRe_A", "EhbI07Zpk_A", "6lObl0ZdB4o",
            "VT2NheI5AX8", "xdfsqe0WITw", "eoPqxCR9uGQ", "SdC1xTRMNfc", "bQy70JcwAyY",
            "d6xtVsMGtww", "qqymyxP4AYw", "ectTCvuDH6k", "vmR-9g4FhZs", "S8fI4KPhw3o",
            "CAvCQZLJ3Uk", "Xy4yD5pIqZQ", "EpWqbIZHUko", "wwmKBpfyMNc", "a_tIFBNQ070",
            "ztAT5yD1yLw", "cfCjQFuj8bY", "cvhU_mq87Qc", "XE-Wz9Zmtko", "-QAlRoe2OTE",
            "-aKvjO-FpSM", "6BmSFvK5djk", "a1qs6498g_A", "ysbA3S0epuI", "SQy3zeux_-c",
            "OzY7kI5xOpc", "lr-xfRQorms", "OHSNjX5eCwI", "u1l_vNVyOjI", "ve8BI7w025Q",
            "No3abRpVc68", "SVBelCAslmM", "0js8o0YFyo0", "FuHSXTbKnCU", "UjnzrjOORh0",
            "AumZpXXeJ2I", "mt_Fy6iwHtI", "WP_YMq_izyE", "7ozh91sg0-M", "-uYvT9ApPr0",
            "M_xfPV1TP2Y", "32PdaIJw_CI", "Twfx_0KXmjY", "f7uwKg3uiEI", "F8r42kkh-tM",
            "lIXSe9tvn_A", "lJjRQCOgMwQ", "yRUVMRIyeQA", "3NaCBWzRqok", "KFmmJDmiFBQ",
            "m2iSVowniXg", "LgmzYLj0e9E", "b5Qyej_NeEI", "zzzWHpkPFbM", "amEeugZXGQg",
            "WZiQjdjWw58", "jSksZT3jwl4", "skuE9unvAPo", "WPvjMFOhXtc", "oQHvIX2TkFs",
            "TQcG5kSI_s8", "yqzgMqdDcHw", "CvumcA54M6s", "Sg3E3Nv6ldY", "iJoGzA0wtlo",
            "vTeSgrKhDQw", "brE4aQAdgi8", "EJtThjzjldM", "CnTFDgE1gec", "gJMqMPnOU94",
            "5cO0fx09eoE", "UBNYYTFCCD8", "NsgDJ6ufaho", "fsZGq-4qJng", "o5DsOdSZP5k",
            "rHwRFhRMb5w", "quSgniKvxuY", "O55cCp4jNLM", "1cSuzphxi8c", "cWb0Io3wKVs",
            "AADSvz6ckz8", "GIsP_4w7gCE", "i2X4y-Kx6XM", "13DRS3Mqxc4", "yrA5Al5y20U",
            "CEHOTp9ACkI", "WiDQhUaUP80", "mGU7grNdizo", "P61S0x2cAOM", "nWG4sxZsTFo",
            "ea3PCQK6QME", "zo18xABy4AI", "0LXByPMRdhY", "X0Tl_iJF3-o", "1iWt5EWNfHM",
            "0cnBEAig9yM", "2IWT3SFhGIQ", "V8kKOQCSxHE", "AVJSQuRa5RM", "0W2DDXbrYx4",
            "qttDZyNuDyc", "S_DBaArmXM8", "oo5zAjRolMs", "nhx4sNtOY28", "JYGyBpWs2Xw",
            "E5gx3dPomrg", "1vhNDygrN9Q", "Gd4MvlUosuc", "7NGuG54EhTc", "RzJ27Kx7bxw",
            "Rcqe7cGa-FI", "3BSLzWRXz5s", "D-P4Fm6b4zg", "fjFEGCnCF04", "BDvZOVrTOjM",
            "6Uqg0R1V_yQ", "iajcLSonbW0", "2-3SQhkyVAE", "V73SeV5T2t0", "vfosnIxVC6I",
            "M3fKb_qypzw", "DfhRsyhuXYY", "S1vew5sFMBY", "1YNtZ7jv5X8", "_TUSYYcJJo8",
            "20OPEnUOgTM", "FcylxgJRV8A", "woOrP4ODNrc", "d-6UYtQTWuU", "K2fIiTZY7aE",
            "kR_FfvtTRRQ", "Qi_VxYnhSe0", "b7KWWnOEN9o", "TxfZN5kkGNA", "4ue1cf6bm1U",
            "eRJj_bMz8uc", "qj5K2fGlL4s", "CFupVR_6QQM", "48Yle_F4CDM", "Nflyj2GTcxk",
            "30Tp6mDlruo", "UP8OuUoCjoQ", "b-DHemNvyWM", "VqCH4IrWkcg", "eYmWdJM1fXo",
            "EGiA648irw8", "9HcB8rM-l9k", "Ze_rF168Qgw", "enUHpqdjBXA", "ByIccEjGhio",
            "gDe3W4sTeYk", "ao4cUUDzGWE", "fjXzxotZ_Zg", "9IHdWhSMJpA", "O4X-itUd124",
            "9Lo7jUSMsZ4", "IpqnRi4Mm9M", "9NKhe80947A", "8GwyHTPvZg8", "UV3-_TupXRM",
            "J9CqUnr5mjQ", "4XRm0NUb2BI", "otXyjpkODVQ", "SU1neRnrbxA", "CZt3vYstA68",
            "75z2XetOiJI", "iQn8uPP4P2Y", "tcd_1eLsQl4", "ltTVPgMNCeQ", "SNE6WzUYc0A",
            "O6s9WJBxEi0", "yal0HoeQCMc", "RxIqReGbml4", "VP6El8jvlJw", "Oa7n-0s0QNY",
            "hmnBN1_WlrQ", "UW9zBXoxNY4", "PvGsdIZ50J8", "KJpG0cZy-Fw", "8AU2yYeQmx8",
            "0cixI-eAL9I", "vpiSeiOheU0", "N_JzHl0uxNU", "C5ZeGUOWWCE", "TyLUKUZgDmY",
            "-H-__l8CcKU", "TMVjJHIp5-g", "q-8oyMD-3YQ", "kegasmqaq6E", "OiE6gaLGuCQ",
            "4EBBl9IlovU", "BMTAC3xBqyg", "1bcJu7ofC-Q", "xTMU5q5R2mA", "bx0Qt6rjxIg",
            "faM25qwtJ20", "jkyJpPJ_dNk", "0OpOzFZ8440", "9dt7V2d6hQc", "8eMMV-gdDgQ",
            "qxDs9jkPAxo", "fyMW9dT6PUI", "EfsoOpbh_nI", "axEHqzwdiiI", "az79_vFF8Cs",
            "ExR0p2VCtPI", "Gf8IveD8YqY", "VJ7aEJTxQ1E", "XqrHwpxLpko", "t8ulrBBgVw0",
            "S7YOvummsqo", "ag1K6tU56bA", "mr2nutBPpkQ", "aJoIaVUK8uE", "Ljc4nFmA5Aw",
            "-hH1uSXXC28", "u6dzPVqwFEE", "oPjqt2E2CTw", "zDM5S98lbRY", "KY-pRea41xc",
            "3f8IO2e5D6E", "7k-WWVMpcdA", "WJ_PkfAytyM", "QbxDNXgCX7E", "PAfBiqiBjCU",
            "8xE8AqyLMS0", "M40_IApObCo", "3xUk91W_FWU", "jVnjIIC3ATY", "cnA7YmepUiA",
            "XmkcnTeL0Q0", "hiq33dPmTBM", "XjVz4ztJdSk", "607GsFWcn_U", "LRkHvV75LbY",
            "qaClTvvBbLg", "nhMUOBzlzEo", "Zjjb6UCDjos", "1xnKwv38IIc", "v8ijjUh2-Ww",
            "BhBzixHMdOE", "jQAXQ2ljlLE", "nNJN8wnSwWE", "lfmLv56uNOk", "7yajO2dbIbs",
            "XB9HV96Y3OM", "69aUZWahu3Q", "PtsBijAUqiE", "X3Sj74eFuo8", "ZcNGMoj9KZw",
            "L9qozw78_7I", "p_EFoBQynKc", "k1wnrXeIhjo", "ithmHO7zZVI", "kgr-NiCNrY8",
            "IhzRncJo6lE", "ElgF6FCiGI4", "l5epGxTQnzA", "6NAEhZnbNgQ", "LQKwIG1XJ9Q",
            "GKoLWKEURjw", "g_HD8IkH_iI", "OodroBam7Kk", "7f2gfS0dGmo", "G0LL06I254U",
            "iTCVDL-FNzE", "PutRXdLNJY8", "Tst3uPVsGZI", "5WwRIzOVKT8", "_cuTCzHF-4I",
            "Qpka-DQTovI", "boDC_kOK5TY", "ZWeN8EHbMaA", "fAz3665jgEM", "JWPO6BpvQrE",
            "0Awu6_UW3J0", "hNeDBHOy6fo", "Q-BDuX13ukY", "Gs9MZL73VVY", "3Qz5UZ9YByM",
            "nmPn747Pke8", "Q3TKlcf9tGk", "TBmvveW2yJk", "O9-Y1ND4NQc", "izBAI8IaTy8",
            "GorzyRBNhZM", "P5xIBQj05Tg", "nssqiGPy4_E", "PKbpcnnzuw0", "HkK9CvD9z00",
            "LFFUSqsmqvo", "FGrayRlYvMo", "cZgHIcEXDY8", "TTCLh8C938Q", "pPp40rLjZ1g",
            "EtiYmLhcsNg", "7AVDaTOJU94", "7W1r3NCwfVI", "Maeu07NPLY4", "YuU5YtWAhDw",
            "rJuFqF14A-c", "4Nw37OGHd0s", "PPfT7NiGscA", "r6NDDLdePng", "KnNV4CoRPzU",
            "xZcZ2aM6rhs", "kmIbtT04X6A", "5n8ImtckRUM", "zDYwMZMwc4M", "VLzxU2pi1ck",
            "P4rQpJX1Qzs", "0rNJ6FxjmYU", "-mFUKGYbnEM"
        ];

        // YouTube Link Szerkeszt≈ë funkci√≥k
        function initLinkEditor() {
            const linksContainer = document.getElementById('linksContainer');
            const linkCountElement = document.getElementById('linkCount');
            
            // Link lista megjelen√≠t√©se
            function renderLinks() {
                linksContainer.innerHTML = '';
                linkCountElement.textContent = allYouTubeLinks.length;
                
                allYouTubeLinks.forEach((link, index) => {
                    const linkItem = document.createElement('div');
                    linkItem.className = 'link-item';
                    linkItem.innerHTML = `
                        <div class="link-number">${index + 1}.</div>
                        <input type="text" class="link-input" value="${link}" data-index="${index}">
                        <div class="link-actions">
                            <button class="link-btn delete" data-index="${index}">Delete</button>
                            <button class="link-btn" data-index="${index}" onclick="moveLinkUp(${index})">‚Üë</button>
                            <button class="link-btn" data-index="${index}" onclick="moveLinkDown(${index})">‚Üì</button>
                        </div>
                    `;
                    linksContainer.appendChild(linkItem);
                });
                
                updateEditorStatus('Curriculum updated');
            }
            
            // Link hozz√°ad√°sa
            document.getElementById('addLinkBtn').addEventListener('click', function() {
                allYouTubeLinks.push('');
                renderLinks();
                updateEditorStatus('New piece added to curriculum');
            });
            
            // √ñsszes link t√∂rl√©se
            document.getElementById('deleteAllBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete all curriculum pieces?')) {
                    allYouTubeLinks = [];
                    renderLinks();
                    updateEditorStatus('All curriculum pieces deleted');
                }
            });
            
            // Linkek rendez√©se
            document.getElementById('sortLinksBtn').addEventListener('click', function() {
                allYouTubeLinks.sort();
                renderLinks();
                updateEditorStatus('Curriculum sorted alphabetically');
            });
            
            // Linkek m√°sol√°sa
            document.getElementById('copyLinksBtn').addEventListener('click', function() {
                const linksText = allYouTubeLinks.join('\n');
                navigator.clipboard.writeText(linksText)
                    .then(() => updateEditorStatus('Curriculum copied to clipboard'))
                    .catch(err => updateEditorStatus('Copy error: ' + err));
            });
            
            // Linkek beilleszt√©se
            document.getElementById('pasteLinksBtn').addEventListener('click', function() {
                navigator.clipboard.readText()
                    .then(text => {
                        const newLinks = text.split('\n').filter(link => link.trim() !== '');
                        allYouTubeLinks = [...allYouTubeLinks, ...newLinks];
                        renderLinks();
                        updateEditorStatus(`${newLinks.length} pieces added to curriculum`);
                    })
                    .catch(err => updateEditorStatus('Paste error: ' + err));
            });
            
            // Linkek ment√©se
            document.getElementById('saveLinksBtn').addEventListener('click', function() {
                // Friss√≠tj√ºk a linkeket az input mez≈ëkb≈ël
                const linkInputs = document.querySelectorAll('.link-input');
                allYouTubeLinks = Array.from(linkInputs).map(input => input.value.trim()).filter(link => link !== '');
                
                // √öjragener√°ljuk a batch-eket
                batches = generateDynamicBatches();
                updateBatchProgress();
                updateStats();
                
                updateEditorStatus('Curriculum saved and sessions regenerated');
            });

            // CSV export√°l√°s
            document.getElementById('exportCSVBtn').addEventListener('click', function() {
                exportLinksToCSV();
            });

            // CSV import√°l√°s
            document.getElementById('importCSVBtn').addEventListener('click', function() {
                document.getElementById('csvImportInput').click();
            });

            // CSV f√°jl beolvas√°sa
            document.getElementById('csvImportInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    importLinksFromCSV(file);
                }
            });
            
            // Link t√∂rl√©se (deleg√°lt esem√©nykezel√©s)
            linksContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('delete')) {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    if (!isNaN(index) && index >= 0 && index < allYouTubeLinks.length) {
                        allYouTubeLinks.splice(index, 1);
                        renderLinks();
                        updateEditorStatus(`Piece #${index + 1} removed from curriculum`);
                    }
                }
            });
            
            // Link mozgat√°sa felfel√©
            window.moveLinkUp = function(index) {
                if (index > 0) {
                    [allYouTubeLinks[index], allYouTubeLinks[index - 1]] = [allYouTubeLinks[index - 1], allYouTubeLinks[index]];
                    renderLinks();
                    updateEditorStatus(`Piece #${index + 1} moved up`);
                }
            };
            
            // Link mozgat√°sa lefel√©
            window.moveLinkDown = function(index) {
                if (index < allYouTubeLinks.length - 1) {
                    [allYouTubeLinks[index], allYouTubeLinks[index + 1]] = [allYouTubeLinks[index + 1], allYouTubeLinks[index]];
                    renderLinks();
                    updateEditorStatus(`Piece #${index + 1} moved down`);
                }
            };
            
            // Szerkeszt≈ë √°llapot friss√≠t√©se
            function updateEditorStatus(message) {
                const statusElement = document.getElementById('editorStatus');
                statusElement.innerHTML = `${message} | Total <span id="linkCount">${allYouTubeLinks.length}</span> classical music pieces in curriculum`;
            }

            // CSV export√°l√°s
            function exportLinksToCSV() {
                // CSV fejl√©c
                let csvContent = "Classical Music Piece ID,Institution,Student Count,Context,Location,Language\n";
                
                // Linkek hozz√°ad√°sa
                allYouTubeLinks.forEach(link => {
                    csvContent += `${link},Crescendo Classical Music Academy,389,educational_listening,Ashburn Virginia,en-US\n`;
                });
                
                // CSV f√°jl l√©trehoz√°sa √©s let√∂lt√©se
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', 'crescendo_academy_curriculum.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                updateEditorStatus('Curriculum exported to CSV file');
            }

            // CSV import√°l√°s
            function importLinksFromCSV(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const csvContent = e.target.result;
                        const lines = csvContent.split('\n');
                        const importedLinks = [];
                        
                        // CSV sorok feldolgoz√°sa (els≈ë sor a fejl√©c)
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (line) {
                                const columns = line.split(',');
                                // Els≈ë oszlop a YouTube ID
                                const videoId = extractYouTubeId(columns[0]);
                                if (videoId) {
                                    importedLinks.push(videoId);
                                }
                            }
                        }
                        
                        if (importedLinks.length > 0) {
                            // √öj linkek hozz√°ad√°sa a megl√©v≈ëkh√∂z
                            allYouTubeLinks = [...allYouTubeLinks, ...importedLinks];
                            renderLinks();
                            updateEditorStatus(`${importedLinks.length} pieces imported from curriculum CSV`);
                        } else {
                            updateEditorStatus('No valid classical music pieces found in CSV file');
                        }
                    } catch (error) {
                        updateEditorStatus('Error importing curriculum CSV: ' + error.message);
                    }
                };
                
                reader.onerror = function() {
                    updateEditorStatus('Error reading curriculum CSV file');
                };
                
                reader.readAsText(file);
            }

            // YouTube ID kinyer√©se URL-b≈ël vagy sima ID-b≈ël
            function extractYouTubeId(input) {
                // Ha m√°r csak az ID van
                if (/^[a-zA-Z0-9_-]{11}$/.test(input)) {
                    return input;
                }
                
                // YouTube URL-b≈ël ID kinyer√©se
                const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
                const match = input.match(youtubeRegex);
                return match ? match[1] : null;
            }
            
            // Kezdeti renderel√©s
            renderLinks();
        }

        // Dinamikus batch gener√°l√°s - FIREFOX OPTIMALIZ√ÅLT
        function generateDynamicBatches() {
            let batches = [];
            let remainingZones = MANUAL_CONTROL_CONFIG.BATCH.TARGET_TOTAL;
            let batchNumber = 1;
            
            while (remainingZones > 0) {
                // V√©letlenszer≈± batch m√©ret - FIREFOX OPTIMALIZ√ÅLT
                const maxBatchSize = Math.min(MANUAL_CONTROL_CONFIG.BATCH.MAX_SIZE, remainingZones);
                const minBatchSize = Math.min(MANUAL_CONTROL_CONFIG.BATCH.MIN_SIZE, remainingZones);
                
                const batchSize = Math.floor(
                    Math.random() * (maxBatchSize - minBatchSize + 1)
                ) + minBatchSize;
                
                const startIndex = batches.reduce((sum, batch) => sum + batch.size, 0);
                const endIndex = startIndex + batchSize - 1;
                
                batches.push({
                    start: startIndex,
                    end: endIndex,
                    size: batchSize,
                    name: `Student Session ${batchNumber}`,
                    duration: 0 // Nincs id≈ëz√≠t√©s
                });
                
                remainingZones -= batchSize;
                batchNumber++;
            }
            
            return batches;
        }

        // Linkek v√©letlenszer≈± kever√©se
        function shuffleYouTubeLinks() {
            console.log('üîÄ Curriculum pieces shuffling (Academy optimized)...');
            
            for (let i = allYouTubeLinks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allYouTubeLinks[i], allYouTubeLinks[j]] = [allYouTubeLinks[j], allYouTubeLinks[i]];
            }
            
            document.getElementById('statusMessage').innerHTML = 
                'üîÄ Curriculum reshuffled! 389 Students - Classical Music Academy - Ashburn, Virginia Campus.';
            
            updateStats();
        }

        // Dinamikus batch-ek
        let batches = generateDynamicBatches();

        let youtubePlayers = new Array(allYouTubeLinks.length);
        let playersReady = 0;
        let activePlayers = 0;
        let currentBatchIndex = -1;
        let isLoading = false;
        let cycleCount = 0;
        
        // Minim√°lt vide√≥k kezel√©se
        let minimizedVideos = new Set();
        let closedVideos = new Set();
        
        // Lej√°tsz√°si statisztik√°k
        let playbackStats = {
            totalPlaybacks: 0,
            monthlyStats: {}
        };

        // Rekl√°m statisztik√°k
        let adStats = {
            totalAds: 0,
            successfulAds: 0,
            estimatedRevenue: 0,
            adEvents: []
        };

        // Kock√°zat√©rt√©kel√©s
        let riskAssessment = {
            patternScore: 0,
            timingScore: 0,
            behaviorScore: 0,
            totalScore: 0,
            lastUpdate: Date.now()
        };

        // Mem√≥ria monitor
        let memoryStats = {
            cleanupCount: 0,
            lastCleanup: null,
            totalMemoryFreed: 0,
            monitoringActive: true
        };

        // Graci√°lis le√°ll√°s v√°ltoz√≥k
        let gracefulShutdownActive = false;
        let gracefulShutdownTimer = null;
        let gracefulShutdownEndTime = null;
        let gracefulShutdownInterval = null;

        // Ujjlenyomat gener√°l√°s
        let currentFingerprint = null;
        let fingerprintCount = 0;

        // Performance monitor
        let fpsCounter = 0;
        let lastFpsUpdate = Date.now();
        let frameCount = 0;
        let performanceStats = {
            loadTimes: [],
            playerStability: 100,
            firefoxOptimized: true
        };

        // √öj Error Monitoring v√°ltoz√≥k
        let errorStats = {
            captchaDetected: false,
            rateLimitCount: 0,
            failedRequests: 0,
            lastErrorCheck: Date.now(),
            sessionHealth: 'good'
        };

        // √öj Hardware Simulation v√°ltoz√≥k
        let hardwareStats = {
            cpuUsage: 15,
            memoryUsage: 24,
            networkLatency: 42,
            fingerprintRotations: 0,
            lastHardwareUpdate: Date.now()
        };

        // ========== ASHBURN, VIRGINIA ACADEMY KONFIGUR√ÅCI√ì ==========
        let currentIP = ASHBURN_IPS[0];
        let requestCount = 0;
        let sessionStartTime = Date.now();

        // ========== √öJ ERROR MONITORING FUNKCI√ìK ==========

        // YouTube Error monitoring - CSAK JELZ√âS, NEM AUTOMATIKUS STOP
        function startErrorMonitoring() {
            setInterval(() => {
                checkForYouTubeErrors();
                updateErrorDisplay();
            }, ERROR_MONITOR_CONFIG.CHECK_INTERVAL);
        }

        // YouTube hib√°k ellen≈ërz√©se
        function checkForYouTubeErrors() {
            // CAPTCHA detekt√°l√°s (egyszer≈±s√≠tett)
            const hasCaptcha = document.body.innerHTML.includes('captcha') || 
                              document.body.innerHTML.includes('robot') ||
                              document.title.includes('Verify');
            
            if (hasCaptcha && !errorStats.captchaDetected) {
                errorStats.captchaDetected = true;
                console.warn('üö® CAPTCHA detected! Manual intervention required.');
            }

            // Rate limit ellen≈ërz√©s
            const videoErrors = document.querySelectorAll('[id*="player"]').length - playersReady;
            if (videoErrors > 10) {
                errorStats.rateLimitCount++;
            }

            // Session health ellen≈ërz√©s
            const timeSinceLastAction = Date.now() - errorStats.lastErrorCheck;
            if (timeSinceLastAction > 60000) { // 1 perc inaktivit√°s
                errorStats.sessionHealth = 'stale';
            } else {
                errorStats.sessionHealth = 'good';
            }

            errorStats.lastErrorCheck = Date.now();
        }

        // Error √°llapot megjelen√≠t√©se
        function updateErrorDisplay() {
            const captchaStatus = document.getElementById('captchaStatus');
            const rateLimitStatus = document.getElementById('rateLimitStatus');
            const requestStatus = document.getElementById('requestStatus');
            const sessionStatus = document.getElementById('sessionStatus');

            // CAPTCHA status
            if (errorStats.captchaDetected) {
                captchaStatus.className = 'error-indicator danger';
                captchaStatus.querySelector('.error-value').textContent = 'CAPTCHA!';
            } else {
                captchaStatus.className = 'error-indicator safe';
                captchaStatus.querySelector('.error-value').textContent = 'No CAPTCHA';
            }

            // Rate limit status
            if (errorStats.rateLimitCount > 5) {
                rateLimitStatus.className = 'error-indicator danger';
                rateLimitStatus.querySelector('.error-value').textContent = 'High';
            } else if (errorStats.rateLimitCount > 2) {
                rateLimitStatus.className = 'error-indicator warning';
                rateLimitStatus.querySelector('.error-value').textContent = 'Medium';
            } else {
                rateLimitStatus.className = 'error-indicator safe';
                rateLimitStatus.querySelector('.error-value').textContent = 'Normal';
            }

            // Request status
            if (errorStats.failedRequests > 10) {
                requestStatus.className = 'error-indicator danger';
                requestStatus.querySelector('.error-value').textContent = 'Unstable';
            } else if (errorStats.failedRequests > 5) {
                requestStatus.className = 'error-indicator warning';
                requestStatus.querySelector('.error-value').textContent = 'Slow';
            } else {
                requestStatus.className = 'error-indicator safe';
                requestStatus.querySelector('.error-value').textContent = 'Stable';
            }

            // Session status
            if (errorStats.sessionHealth === 'stale') {
                sessionStatus.className = 'error-indicator warning';
                sessionStatus.querySelector('.error-value').textContent = 'Stale';
            } else {
                sessionStatus.className = 'error-indicator safe';
                sessionStatus.querySelector('.error-value').textContent = 'Active';
            }
        }

        // ========== √öJ HARDWARE SIMULATION FUNKCI√ìK ==========

        // Hardware szimul√°ci√≥ ind√≠t√°sa
        function startHardwareSimulation() {
            setInterval(() => {
                updateHardwareStats();
                updateHardwareDisplay();
            }, HARDWARE_SIMULATION_CONFIG.UPDATE_INTERVAL);
        }

        // Hardware statisztik√°k friss√≠t√©se
        function updateHardwareStats() {
            // CPU usage szimul√°ci√≥
            hardwareStats.cpuUsage = Math.floor(
                Math.random() * (HARDWARE_SIMULATION_CONFIG.CPU_USAGE_RANGE.max - 
                HARDWARE_SIMULATION_CONFIG.CPU_USAGE_RANGE.min + 1)
            ) + HARDWARE_SIMULATION_CONFIG.CPU_USAGE_RANGE.min;

            // Memory usage szimul√°ci√≥
            hardwareStats.memoryUsage = Math.floor(
                Math.random() * (HARDWARE_SIMULATION_CONFIG.MEMORY_USAGE_RANGE.max - 
                HARDWARE_SIMULATION_CONFIG.MEMORY_USAGE_RANGE.min + 1)
            ) + HARDWARE_SIMULATION_CONFIG.MEMORY_USAGE_RANGE.min;

            // Network latency szimul√°ci√≥
            hardwareStats.networkLatency = Math.floor(
                Math.random() * (HARDWARE_SIMULATION_CONFIG.NETWORK_LATENCY_RANGE.max - 
                HARDWARE_SIMULATION_CONFIG.NETWORK_LATENCY_RANGE.min + 1)
            ) + HARDWARE_SIMULATION_CONFIG.NETWORK_LATENCY_RANGE.min;

            hardwareStats.lastHardwareUpdate = Date.now();
        }

        // Hardware inform√°ci√≥k megjelen√≠t√©se
        function updateHardwareDisplay() {
            document.getElementById('cpuUsage').textContent = hardwareStats.cpuUsage + '%';
            document.getElementById('memoryUsageSim').textContent = hardwareStats.memoryUsage + '%';
            document.getElementById('networkLatency').textContent = hardwareStats.networkLatency + 'ms';
            document.getElementById('fingerprintRotation').textContent = hardwareStats.fingerprintRotations;
        }

        // ========== √öJ ANTI-DETECTION FEJLESZT√âSEK - ASHBURN, VIRGINIA ==========

        // Ashburn IP c√≠m gener√°l√°s
        function generateAshburnIP() {
            return ASHBURN_IPS[Math.floor(Math.random() * ASHBURN_IPS.length)];
        }

        // Ashburn IP rot√°ci√≥
        function rotateIP() {
            currentIP = generateAshburnIP();
            document.getElementById('currentIP').textContent = currentIP + ' (Ashburn, VA)';
            console.log(`üîÑ Ashburn IP rotated: ${currentIP}`);
        }

        // Ashburn User Agent randomiz√°l√°s
        function rotateUserAgent() {
            const randomUA = ASHBURN_USER_AGENTS[Math.floor(Math.random() * ASHBURN_USER_AGENTS.length)];
            
            Object.defineProperty(navigator, 'userAgent', {
                value: randomUA,
                configurable: true
            });
            
            document.getElementById('currentUA').textContent = 'Student ' + (Math.floor(Math.random() * 389) + 1);
            console.log('üîÑ Ashburn User Agent rotated');
        }

        // Ashburn id≈ëz√≥na manipul√°ci√≥
        function manipulateTimezone() {
            // Ashburn id≈ëz√≥na
            const ashburnTZ = 'America/New_York';
            
            document.getElementById('currentTZ').textContent = 'Ashburn, VA';
            console.log(`üïê Ashburn context: ${ashburnTZ}`);
        }

        // Ashburn nyelvi be√°ll√≠t√°sok
        function setAshburnLanguage() {
            // Ashburn nyelvek
            const ashburnLang = 'en-US';
            
            Object.defineProperty(navigator, 'language', {
                value: ashburnLang,
                configurable: true
            });
            
            Object.defineProperty(navigator, 'languages', {
                value: [ashburnLang],
                configurable: true
            });
            
            console.log(`üåê Ashburn language: ${ashburnLang}`);
        }

        // Fejlettebb fingerprint spoofing rot√°ci√≥
        function advancedFingerprintRotation() {
            hardwareStats.fingerprintRotations++;
            
            // Canvas fingerprint vari√°ci√≥
            const canvasNoiseLevel = Math.floor(Math.random() * 5) + 1;
            applyCanvasNoise(canvasNoiseLevel);
            
            // WebGL fingerprint vari√°ci√≥
            const webGLVariation = Math.floor(Math.random() * 3);
            modifyWebGLFingerprint(webGLVariation);
            
            // Font rendering vari√°ci√≥k
            rotateFontFingerprint();
            
            console.log(`üîÑ Advanced fingerprint rotation #${hardwareStats.fingerprintRotations}`);
        }

        // Canvas noise alkalmaz√°sa
        function applyCanvasNoise(noiseLevel) {
            try {
                const originalGetImageData = CanvasRenderingContext2D.prototype.getImageData;
                CanvasRenderingContext2D.prototype.getImageData = function() {
                    const result = originalGetImageData.apply(this, arguments);
                    // V√°ltoz√≥ noise szint
                    for (let i = 0; i < result.data.length; i += 4) {
                        result.data[i] = result.data[i] + Math.floor(Math.random() * noiseLevel) - Math.floor(noiseLevel/2);
                        result.data[i+1] = result.data[i+1] + Math.floor(Math.random() * noiseLevel) - Math.floor(noiseLevel/2);
                        result.data[i+2] = result.data[i+2] + Math.floor(Math.random() * noiseLevel) - Math.floor(noiseLevel/2);
                    }
                    return result;
                };
            } catch (e) {
                console.log('Canvas noise application error:', e);
            }
        }

        // WebGL fingerprint m√≥dos√≠t√°s
        function modifyWebGLFingerprint(variation) {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (gl) {
                    // V√°ltoztatjuk a WebGL capabilities-t
                    const extension = gl.getExtension('WEBGL_debug_renderer_info');
                    if (extension) {
                        // M√≥dos√≠tjuk a renderer inf√≥t
                        Object.defineProperty(gl, 'getParameter', {
                            value: function(parameter) {
                                if (parameter === extension.UNMASKED_RENDERER_WEBGL) {
                                    const renderers = ['ANGLE (Intel', 'ANGLE (AMD', 'ANGLE (NVIDIA'];
                                    return renderers[variation] || 'ANGLE (Intel';
                                }
                                return WebGLRenderingContext.prototype.getParameter.call(this, parameter);
                            }
                        });
                    }
                }
            } catch (e) {
                console.log('WebGL modification error:', e);
            }
        }

        // Font fingerprint rot√°ci√≥
        function rotateFontFingerprint() {
            try {
                // V√°ltoztatjuk a font list√°t
                const fonts = [
                    ['Arial', 'Helvetica', 'sans-serif'],
                    ['Georgia', 'Times New Roman', 'serif'],
                    ['Courier New', 'Monaco', 'monospace'],
                    ['Verdana', 'Geneva', 'sans-serif']
                ];
                
                const randomFonts = fonts[Math.floor(Math.random() * fonts.length)];
                Object.defineProperty(navigator, 'fonts', {
                    value: {
                        values: () => Promise.resolve(randomFonts)
                    },
                    configurable: true
                });
            } catch (e) {
                console.log('Font rotation error:', e);
            }
        }

        // ========== MINIMIZE √âS CLOSE FUNKCI√ìK ==========

        // Vide√≥ minimize funkci√≥ - JAV√çTOTT: NEM √ÅLL√çTJA LE A VIDE√ìT
        function minimizeVideo(index) {
            const videoPlayer = document.getElementById(`videoPlayer${index}`);
            if (!videoPlayer) return;
            
            // Elrejtj√ºk a vide√≥t
            videoPlayer.style.display = 'none';
            
            // Hozz√°adjuk a minim√°lt vide√≥khoz
            minimizedVideos.add(index);
            
            // Friss√≠tj√ºk a minim√°lt vide√≥k s√°vot
            updateMinimizedBar();
            
            // NEM √ÅLL√çTJUK LE A VIDE√ìT - CSAK ELREJTJ√úK
            // A vide√≥ tov√°bb j√°tsz√≥dik a h√°tt√©rben
            
            // Kattint√°s st√°tusz friss√≠t√©se
            const clickStatus = document.getElementById(`clickStatus${index}`);
            if (clickStatus) {
                clickStatus.textContent = 'üìã Minimized';
                clickStatus.style.background = 'rgba(255, 152, 0, 0.9)';
            }
            
            console.log(`üìã Student session ${index + 1} minimized (continues playing)`);
        }

        // Vide√≥ vissza√°ll√≠t√°sa minimize-b√≥l
        function restoreVideo(index) {
            const videoPlayer = document.getElementById(`videoPlayer${index}`);
            if (!videoPlayer) return;
            
            // Megjelen√≠tj√ºk a vide√≥t
            videoPlayer.style.display = 'block';
            
            // Elt√°vol√≠tjuk a minim√°lt vide√≥kb√≥l
            minimizedVideos.delete(index);
            
            // Friss√≠tj√ºk a minim√°lt vide√≥k s√°vot
            updateMinimizedBar();
            
            // Kattint√°s st√°tusz friss√≠t√©se
            const clickStatus = document.getElementById(`clickStatus${index}`);
            if (clickStatus) {
                // Ellen≈ërizz√ºk, hogy a vide√≥ √©ppen j√°tszik-e
                let isPlaying = false;
                if (youtubePlayers[index] && typeof youtubePlayers[index].getPlayerState === 'function') {
                    try {
                        const state = youtubePlayers[index].getPlayerState();
                        isPlaying = (state === YT.PlayerState.PLAYING);
                    } catch (e) {
                        // Hiba eset√©n figyelmen k√≠v√ºl hagyjuk
                    }
                }
                
                clickStatus.textContent = isPlaying ? '‚ñ∂Ô∏è Listening' : 'üñ±Ô∏è Start Session';
                clickStatus.style.background = isPlaying ? 'rgba(76, 175, 80, 0.9)' : 'rgba(255, 152, 0, 0.9)';
            }
            
            console.log(`üìã Student session ${index + 1} restored`);
        }

        // Vide√≥ bez√°r√°sa
        function closeVideo(index) {
            const videoPlayer = document.getElementById(`videoPlayer${index}`);
            if (!videoPlayer) return;
            
            // Le√°ll√≠tjuk a vide√≥t
            if (youtubePlayers[index] && typeof youtubePlayers[index].stopVideo === 'function') {
                try {
                    youtubePlayers[index].stopVideo();
                } catch (e) {
                    console.log('Error stopping session:', e);
                }
            }
            
            // Elt√°vol√≠tjuk a DOM-b√≥l
            videoPlayer.remove();
            
            // Hozz√°adjuk a bez√°rt vide√≥khoz
            closedVideos.add(index);
            
            // Friss√≠tj√ºk a statisztik√°kat
            playersReady = Math.max(0, playersReady - 1);
            updateStats();
            
            console.log(`‚ùå Student session ${index + 1} closed`);
        }

        // Minim√°lt vide√≥k s√°v friss√≠t√©se
        function updateMinimizedBar() {
            const minimizedBar = document.getElementById('minimizedBar');
            const minimizedVideosContainer = document.getElementById('minimizedVideos');
            
            // √úr√≠tj√ºk a s√°vot
            minimizedVideosContainer.innerHTML = '';
            
            // Ha vannak minim√°lt vide√≥k, megjelen√≠tj√ºk a s√°vot
            if (minimizedVideos.size > 0) {
                minimizedBar.style.display = 'block';
                
                // Hozz√°adjuk a minim√°lt vide√≥kat
                minimizedVideos.forEach(index => {
                    const minimizedVideo = document.createElement('div');
                    minimizedVideo.className = 'minimized-video';
                    minimizedVideo.setAttribute('data-index', index);
                    
                    // √Ållapot ellen≈ërz√©se
                    let isPlaying = false;
                    if (youtubePlayers[index] && typeof youtubePlayers[index].getPlayerState === 'function') {
                        try {
                            const state = youtubePlayers[index].getPlayerState();
                            isPlaying = (state === YT.PlayerState.PLAYING);
                        } catch (e) {
                            // Hiba eset√©n figyelmen k√≠v√ºl hagyjuk
                        }
                    }
                    
                    if (isPlaying) {
                        minimizedVideo.classList.add('playing');
                    }
                    
                    minimizedVideo.innerHTML = `
                        <span>Student ${index + 1}</span>
                        <button class="window-btn restore-btn" style="background: rgba(76, 175, 80, 0.9);">‚Üó</button>
                    `;
                    
                    // Kattint√°s esem√©ny a vissza√°ll√≠t√°shoz
                    minimizedVideo.addEventListener('click', function() {
                        const videoIndex = parseInt(this.getAttribute('data-index'));
                        restoreVideo(videoIndex);
                    });
                    
                    minimizedVideosContainer.appendChild(minimizedVideo);
                });
            } else {
                minimizedBar.style.display = 'none';
            }
        }

        // ========== FIREFOX PERFORMANCE MONITOR ==========
        function startPerformanceMonitor() {
            // FPS sz√°ml√°l√≥
            function updateFPS() {
                frameCount++;
                const now = Date.now();
                if (now - lastFpsUpdate >= 1000) {
                    fpsCounter = frameCount;
                    frameCount = 0;
                    lastFpsUpdate = now;
                    
                    document.getElementById('fpsCounter').textContent = `${fpsCounter} FPS`;
                    
                    // Stability sz√°m√≠t√°s
                    const stability = Math.min(100, Math.max(80, 100 - (60 - fpsCounter) * 2));
                    performanceStats.playerStability = stability;
                    document.getElementById('playerStability').textContent = `${stability}%`;
                }
                requestAnimationFrame(updateFPS);
            }
            
            updateFPS();
            
            // Load time monitor
            const loadStart = Date.now();
            window.addEventListener('load', () => {
                const loadTime = Date.now() - loadStart;
                performanceStats.loadTimes.push(loadTime);
                document.getElementById('loadTime').textContent = `${loadTime}ms`;
            });
        }

        // ========== POPUP ABLAK KEZEL√âS ==========

        // Popup ablak megnyit√°sa
        function openAdPopup(adUrl) {
            const popup = document.getElementById('adPopup');
            const overlay = document.getElementById('popupOverlay');
            const iframe = document.getElementById('popupContent');
            
            iframe.src = adUrl;
            popup.style.display = 'block';
            overlay.style.display = 'block';
            
            // K√∂vetj√ºk a rekl√°m megnyit√°s√°t
            adStats.successfulAds++;
            updateAdStats();
        }

        // Popup ablak bez√°r√°sa
        function closeAdPopup() {
            const popup = document.getElementById('adPopup');
            const overlay = document.getElementById('popupOverlay');
            const iframe = document.getElementById('popupContent');
            
            iframe.src = 'about:blank';
            popup.style.display = 'none';
            overlay.style.display = 'none';
        }

        // V√©letlenszer≈± rekl√°m URL gener√°l√°sa
        function getRandomAdUrl() {
            return AD_WEBSITES[Math.floor(Math.random() * AD_WEBSITES.length)];
        }

        // ========== ASHBURN, VIRGINIA ACADEMY KONTEXTUS ==========

        // Ashburn geolok√°ci√≥ maszkol√°s
        function maskGeolocation() {
            if (navigator.geolocation) {
                const originalGetCurrentPosition = navigator.geolocation.getCurrentPosition;
                navigator.geolocation.getCurrentPosition = function(success, error, options) {
                    // Ashburn campus geolok√°ci√≥s adatok
                    const ashburnLocation = { lat: 39.0438, lng: -77.4874 }; // Ashburn, Virginia
                    
                    const fakePosition = {
                        coords: {
                            latitude: ashburnLocation.lat + (Math.random() - 0.5) * 0.01,
                            longitude: ashburnLocation.lng + (Math.random() - 0.5) * 0.01,
                            accuracy: 500 + Math.random() * 500
                        },
                        timestamp: Date.now()
                    };
                    
                    if (success) success(fakePosition);
                };
                
                console.log('üåç Ashburn Campus Geolocation masked');
            }
        }

        // Session id≈ë friss√≠t√©se
        function updateSessionTime() {
            const now = Date.now();
            const elapsed = now - sessionStartTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.getElementById('sessionTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Ashburn v√©delmi rendszer ind√≠t√°sa
        function startAdvancedProtection() {
            console.log('üõ°Ô∏è Ashburn Academy Protection System starting...');
            
            // Ashburn specifikus be√°ll√≠t√°sok
            setAshburnLanguage();
            manipulateTimezone();
            
            // IP rot√°ci√≥ - ASHBURN
            setInterval(rotateIP, ADVANCED_PROTECTION_CONFIG.IP_ROTATION_INTERVAL);
            
            // Ashburn User Agent rot√°ci√≥
            setInterval(rotateUserAgent, ADVANCED_PROTECTION_CONFIG.USER_AGENT_ROTATION_INTERVAL);
            
            // Traffic szimul√°ci√≥
            setInterval(simulateTrafficEncryption, ADVANCED_PROTECTION_CONFIG.TRAFFIC_SIMULATION_INTERVAL);
            
            // Session id≈ë friss√≠t√©s
            setInterval(updateSessionTime, 1000);
            
            // Canvas fingerprint spoofing - Ashburn optimaliz√°lt
            spoofCanvasFingerprint();
            
            // WebRTC blokkol√°s - Ashburn kompatibilis
            blockWebRTC();
            
            // Eszk√∂z szimul√°ci√≥ - Ashburn standard laptops
            simulateAshburnDevice();
            
            // Geolok√°ci√≥ maszkol√°s
            maskGeolocation();
            
            console.log('‚úÖ Ashburn Academy Protection System active (389 Students - Classical Music Curriculum)');
        }

        // Ashburn eszk√∂z szimul√°ci√≥ - Standard laptops
        function simulateAshburnDevice() {
            // Ashburn standard laptop eszk√∂z√∂k
            const devices = [
                { type: 'Ashburn Academy Laptop', width: 1920, height: 1080 },
                { type: 'Ashburn Academy Laptop', width: 1366, height: 768 },
                { type: 'Ashburn Academy Laptop', width: 1536, height: 864 },
                { type: 'Ashburn Academy Laptop', width: 1440, height: 900 }
            ];
            
            const randomDevice = devices[Math.floor(Math.random() * devices.length)];
            
            // Ashburn kompatibilis eszk√∂zszimul√°ci√≥
            Object.defineProperty(screen, 'width', { 
                value: randomDevice.width,
                configurable: true
            });
            Object.defineProperty(screen, 'height', { 
                value: randomDevice.height,
                configurable: true
            });
            
            document.getElementById('currentProfile').textContent = randomDevice.type;
            console.log(`üì± Ashburn device simulated: ${randomDevice.type} (${randomDevice.width}x${randomDevice.height})`);
        }

        // Canvas fingerprint spoofing (Ashburn optimaliz√°lt)
        function spoofCanvasFingerprint() {
            try {
                const originalGetImageData = CanvasRenderingContext2D.prototype.getImageData;
                CanvasRenderingContext2D.prototype.getImageData = function() {
                    const result = originalGetImageData.apply(this, arguments);
                    // Ashburn optimaliz√°lt m√≥dos√≠t√°s
                    for (let i = 0; i < result.data.length; i += 4) {
                        result.data[i] = result.data[i] + Math.floor(Math.random() * 3) - 1;
                    }
                    return result;
                };
                console.log('üé≠ Ashburn optimized canvas fingerprint spoofing active');
            } catch (e) {
                console.log('Canvas spoofing error:', e);
            }
        }

        // WebRTC blokkol√°s - Ashburn kompatibilis
        function blockWebRTC() {
            try {
                const originalRTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection;
                if (originalRTCPeerConnection) {
                    window.RTCPeerConnection = function(...args) {
                        console.log('üîí WebRTC request blocked (Ashburn)');
                        return null;
                    };
                    window.mozRTCPeerConnection = window.RTCPeerConnection;
                }
                console.log('üîí WebRTC blocked (Ashburn Network)');
            } catch (e) {
                console.log('WebRTC blocking error:', e);
            }
        }

        // Traffic titkos√≠t√°s szimul√°ci√≥ - ASHBURN NETWORK
        function simulateTrafficEncryption() {
            requestCount++;
            document.getElementById('requestCount').textContent = requestCount;
            
            console.log(`üîí Ashburn request #${requestCount} sent from Ashburn IP: ${currentIP}`);
        }

        // ========== GRACI√ÅLIS LE√ÅLL√çT√ÅS ==========

        // Graci√°lis le√°ll√≠t√°s ind√≠t√°sa
        function startGracefulShutdown() {
            if (gracefulShutdownActive) return;
            
            // V√©letlenszer≈± id≈ëtartam 0-1 perc k√∂z√∂tt
            const duration = Math.floor(
                Math.random() * (MANUAL_CONTROL_CONFIG.GRACEFUL_SHUTDOWN.MAX_DURATION - 
                MANUAL_CONTROL_CONFIG.GRACEFUL_SHUTDOWN.MIN_DURATION + 1)
            ) + MANUAL_CONTROL_CONFIG.GRACEFUL_SHUTDOWN.MIN_DURATION;
            
            gracefulShutdownActive = true;
            gracefulShutdownEndTime = Date.now() + duration;
            
            // Graci√°lis le√°ll√°s timer megjelen√≠t√©se
            document.getElementById('gracefulTimer').style.display = 'block';
            
            // Timer friss√≠t√©se
            gracefulShutdownInterval = setInterval(updateGracefulTimer, 1000);
            updateGracefulTimer();
            
            // Vide√≥k fokozatos le√°ll√≠t√°sa
            startGradualShutdown();
            
            document.getElementById('statusMessage').innerHTML = 
                `üïê Graceful shutdown started! Listening sessions will gradually stop within ${Math.round(duration/1000)} seconds.`;
        }

        // Graci√°lis le√°ll√°s timer friss√≠t√©se
        function updateGracefulTimer() {
            if (!gracefulShutdownActive) return;
            
            const now = Date.now();
            const remaining = gracefulShutdownEndTime - now;
            
            if (remaining <= 0) {
                // Id≈ë lej√°rt, mindent le√°ll√≠tunk
                stopGracefulShutdown();
                stopAll();
                return;
            }
            
            const minutes = Math.floor(remaining / 1000 / 60);
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
            
            document.getElementById('gracefulTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('gracefulStatus').textContent = 
                `${activePlayers} active sessions - ${Math.round((remaining / (MANUAL_CONTROL_CONFIG.GRACEFUL_SHUTDOWN.MAX_DURATION)) * 100)}% time remaining`;
        }

        // Vide√≥k fokozatos le√°ll√≠t√°sa
        function startGradualShutdown() {
            if (!gracefulShutdownActive) return;
            
            const shutdownInterval = setInterval(() => {
                if (!gracefulShutdownActive) {
                    clearInterval(shutdownInterval);
                    return;
                }
                
                // V√©letlenszer≈± id≈ëk√∂z√∂nk√©nt le√°ll√≠tunk egy sessiont
                const randomDelay = Math.random() * 10000 + 5000; // 5-15 m√°sodperc
                
                setTimeout(() => {
                    if (!gracefulShutdownActive || activePlayers === 0) return;
                    
                    // Akt√≠v sessionok k√∂z√ºl v√©letlenszer≈±en kiv√°lasztunk egyet
                    const activePlayerIndexes = [];
                    for (let i = 0; i < youtubePlayers.length; i++) {
                        if (youtubePlayers[i] && typeof youtubePlayers[i].getPlayerState === 'function') {
                            try {
                                const state = youtubePlayers[i].getPlayerState();
                                if (state === YT.PlayerState.PLAYING) {
                                    activePlayerIndexes.push(i);
                                }
                            } catch (e) {
                                // Hiba eset√©n kihagyjuk
                            }
                        }
                    }
                    
                    if (activePlayerIndexes.length > 0) {
                        const randomIndex = activePlayerIndexes[Math.floor(Math.random() * activePlayerIndexes.length)];
                        
                        try {
                            youtubePlayers[randomIndex].pauseVideo();
                            
                            // Kattint√°s st√°tusz friss√≠t√©se
                            const clickStatus = document.getElementById(`clickStatus${randomIndex}`);
                            if (clickStatus) {
                                clickStatus.textContent = '‚è∏Ô∏è Graceful';
                                clickStatus.style.background = 'rgba(255, 152, 0, 0.9)';
                            }
                        } catch (e) {
                            console.log('Error stopping session:', e);
                        }
                    }
                }, randomDelay);
                
            }, 3000); // 3 m√°sodpercenk√©nt ind√≠tunk egy le√°ll√≠t√°st
        }

        // Graci√°lis le√°ll√≠t√°s meg√°ll√≠t√°sa
        function stopGracefulShutdown() {
            gracefulShutdownActive = false;
            
            if (gracefulShutdownInterval) {
                clearInterval(gracefulShutdownInterval);
                gracefulShutdownInterval = null;
            }
            
            document.getElementById('gracefulTimer').style.display = 'none';
            document.getElementById('statusMessage').innerHTML = 'Graceful shutdown stopped.';
        }

        // ========== VIDE√ìS PLAYER FUNKCI√ìK - ASHBURN OPTIMALIZ√ÅLT ==========

        // Vide√≥ player l√©trehoz√°sa - ASHBURN OPTIMALIZ√ÅLT
        function createVideoPlayer(videoId, index) {
            const videoGrid = document.getElementById('videoGrid');
            
            const videoPlayer = document.createElement('div');
            videoPlayer.className = 'video-player';
            videoPlayer.id = `videoPlayer${index}`;
            
            const playerContainer = document.createElement('div');
            playerContainer.className = 'player-container';
            playerContainer.id = `playerContainer${index}`;
            
            // Ablakkezel≈ë gombok
            const windowControls = document.createElement('div');
            windowControls.className = 'window-controls';
            windowControls.innerHTML = `
                <button class="window-btn minimize-btn" data-index="${index}">-</button>
                <button class="window-btn close-btn" data-index="${index}">√ó</button>
            `;
            
            // Kattint√°s esem√©ny az ujjlenyomat friss√≠t√©s√©hez √©s session ind√≠t√°s√°hoz
            playerContainer.addEventListener('click', function() {
                updateFingerprintForVideo(index);
                simulateTrafficEncryption();
                
                // Ashburn optimaliz√°lt session ind√≠t√°s
                if (youtubePlayers[index] && typeof youtubePlayers[index].playVideo === 'function') {
                    try {
                        // El≈ësz√∂r √°ll√≠tsuk be a megfelel≈ë st√°tuszt
                        const clickStatus = document.getElementById(`clickStatus${index}`);
                        if (clickStatus) {
                            clickStatus.textContent = '‚è≥ Loading';
                            clickStatus.style.background = 'rgba(33, 150, 243, 0.9)';
                        }
                        
                        // Ashburn optimaliz√°lt session ind√≠t√°s
                        setTimeout(() => {
                            youtubePlayers[index].playVideo();
                        }, 100);
                    } catch (e) {
                        console.log('Error starting session:', e);
                    }
                }
            });
            
            const adIndicator = document.createElement('div');
            adIndicator.className = 'ad-indicator';
            adIndicator.id = `adIndicator${index}`;
            adIndicator.textContent = '‚è≥ Ad';
            adIndicator.style.display = 'none';
            
            const clickStatus = document.createElement('div');
            clickStatus.className = 'click-status';
            clickStatus.id = `clickStatus${index}`;
            clickStatus.textContent = 'üñ±Ô∏è Start Session';
            clickStatus.style.background = 'rgba(255, 152, 0, 0.9)';
            
            const videoInfo = document.createElement('div');
            videoInfo.className = 'video-info';
            videoInfo.textContent = `Student ${index + 1}`;
            
            videoPlayer.appendChild(windowControls);
            videoPlayer.appendChild(playerContainer);
            videoPlayer.appendChild(adIndicator);
            videoPlayer.appendChild(clickStatus);
            videoPlayer.appendChild(videoInfo);
            videoGrid.appendChild(videoPlayer);
            
            // Minimize √©s Close gombok esem√©nykezel≈ëi
            const minimizeBtn = windowControls.querySelector('.minimize-btn');
            const closeBtn = windowControls.querySelector('.close-btn');
            
            minimizeBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // Megakad√°lyozzuk, hogy a session elinduljon
                minimizeVideo(index);
            });
            
            closeBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // Megakad√°lyozzuk, hogy a session elinduljon
                closeVideo(index);
            });
            
            return new Promise((resolve) => {
                // Ashburn optimaliz√°lt YouTube player
                new YT.Player(`playerContainer${index}`, {
                    height: '180',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'playsinline': 1,
                        'enablejsapi': 1,
                        'origin': window.location.origin,
                        'rel': 0,
                        'modestbranding': 1,
                        'controls': 1,  // Vez√©rl≈ëk l√°that√≥ak
                        'showinfo': 0,
                        'iv_load_policy': 3,
                        'autoplay': 0,   // Nincs autoplay
                        'fs': 0,         // Teljes k√©perny≈ë letiltva
                        'widget_referrer': 'https://crescendo1813.github.io/classicalmusicacademy',
                        'vq': 'small' // Optimal quality be√°ll√≠t√°sa
                    },
                    events: {
                        'onReady': function(event) {
                            youtubePlayers[index] = event.target;
                            playersReady++;
                            updateStats();
                            
                            // Ashburn optimaliz√°lt bet√∂lt√©s
                            if (playersReady === allYouTubeLinks.length) {
                                document.getElementById('statusMessage').innerHTML += 
                                    '<br>‚úÖ Academy Curriculum loaded successfully! 389 Students Ready.';
                            }
                            
                            resolve(event.target);
                        },
                        'onStateChange': function(event) {
                            // Ashburn optimaliz√°lt st√°tusz kezel√©s
                            handlePlayerStateChange(event, index);
                        },
                        'onError': function(event) {
                            console.error(`Ashburn error at student ${index + 1}:`, event.data);
                            // Ashburn hibakezel√©s
                            const clickStatus = document.getElementById(`clickStatus${index}`);
                            if (clickStatus) {
                                clickStatus.textContent = '‚ùå Error';
                                clickStatus.style.background = 'rgba(244, 67, 54, 0.9)';
                            }
                            resolve(null);
                        }
                    }
                });
            });
        }

        // Ashburn optimaliz√°lt st√°tusz kezel√©s
        function handlePlayerStateChange(event, index) {
            const clickStatus = document.getElementById(`clickStatus${index}`);
            const adIndicator = document.getElementById(`adIndicator${index}`);
            
            switch (event.data) {
                case YT.PlayerState.PLAYING:
                    activePlayers++;
                    updateStats();
                    
                    if (clickStatus) {
                        clickStatus.textContent = '‚ñ∂Ô∏è Listening';
                        clickStatus.style.background = 'rgba(76, 175, 80, 0.9)';
                    }
                    
                    // Lej√°tsz√°s hozz√°ad√°sa a statisztik√°khoz
                    addPlayback(1);
                    
                    // Rekl√°m ut√°ni √°llapot friss√≠t√©s
                    if (adIndicator && adIndicator.style.display === 'block') {
                        adStats.successfulAds++;
                        adStats.estimatedRevenue += 0.01;
                        updateAdStats();
                        adIndicator.style.display = 'none';
                    }
                    break;
                    
                case YT.PlayerState.PAUSED:
                case YT.PlayerState.ENDED:
                    activePlayers = Math.max(0, activePlayers - 1);
                    updateStats();
                    
                    if (clickStatus) {
                        if (gracefulShutdownActive) {
                            clickStatus.textContent = '‚è∏Ô∏è Graceful';
                        } else {
                            clickStatus.textContent = event.data === YT.PlayerState.PAUSED ? '‚è∏Ô∏è Paused' : '‚èπÔ∏è Ended';
                        }
                        clickStatus.style.background = 'rgba(255, 152, 0, 0.9)';
                    }
                    break;
                    
                case YT.PlayerState.BUFFERING:
                    if (clickStatus) {
                        clickStatus.textContent = '‚è≥ Loading';
                        clickStatus.style.background = 'rgba(33, 150, 243, 0.9)';
                    }
                    break;
                    
                case YT.PlayerState.CUED:
                    if (clickStatus) {
                        clickStatus.textContent = 'üñ±Ô∏è Start Session';
                        clickStatus.style.background = 'rgba(255, 152, 0, 0.9)';
                    }
                    break;
            }
            
            // Rekl√°m √°llapot k√∂vet√©se
            trackAdState(event, index);
        }

        // Rekl√°m √°llapot k√∂vet√©se - ASHBURN OPTIMALIZ√ÅLT
        function trackAdState(event, index) {
            const adIndicator = document.getElementById(`adIndicator${index}`);
            const clickStatus = document.getElementById(`clickStatus${index}`);
            
            switch (event.data) {
                case YT.PlayerState.AD_PLAYING:
                    if (adIndicator) {
                        adIndicator.style.display = 'block';
                        adIndicator.textContent = 'üì∫ Ad';
                        adIndicator.style.background = 'rgba(255, 193, 7, 0.9)';
                    }
                    if (clickStatus) {
                        clickStatus.textContent = 'üì∫ Ad Playing';
                        clickStatus.style.background = 'rgba(255, 193, 7, 0.9)';
                    }
                    adStats.totalAds++;
                    updateAdStats();
                    
                    // Rekl√°m kattint√°s figyel√©se
                    setTimeout(() => {
                        if (adIndicator && adIndicator.style.display === 'block') {
                            setupAdClickHandler(index);
                        }
                    }, 2000);
                    break;
                    
                case YT.PlayerState.PLAYING:
                    // Rekl√°m ut√°ni session ind√≠t√°s - st√°tusz friss√≠t√©s
                    if (adIndicator && adIndicator.style.display === 'block') {
                        adStats.successfulAds++;
                        adStats.estimatedRevenue += 0.01;
                        updateAdStats();
                        adIndicator.style.display = 'none';
                        
                        if (clickStatus) {
                            clickStatus.textContent = '‚ñ∂Ô∏è Listening';
                            clickStatus.style.background = 'rgba(76, 175, 80, 0.9)';
                        }
                    }
                    break;
                    
                case YT.PlayerState.BUFFERING:
                    if (adIndicator) {
                        adIndicator.style.display = 'block';
                        adIndicator.textContent = '‚è≥ Loading';
                        adIndicator.style.background = 'rgba(33, 150, 243, 0.9)';
                    }
                    break;
            }
        }

        // Rekl√°m kattint√°s kezel≈ë be√°ll√≠t√°sa
        function setupAdClickHandler(index) {
            const playerContainer = document.getElementById(`playerContainer${index}`);
            if (!playerContainer) return;
            
            // Ideiglenes kattint√°s kezel≈ë rekl√°mokhoz
            const adClickHandler = function(e) {
                // V√©letlenszer≈± rekl√°m weboldal megnyit√°sa
                const adUrl = getRandomAdUrl();
                openAdPopup(adUrl);
                
                // Esem√©ny elt√°vol√≠t√°sa a duplik√°lt kattint√°sok elker√ºl√©s√©re
                playerContainer.removeEventListener('click', adClickHandler);
                
                // Jelz√©s, hogy a rekl√°mra kattintottak
                const clickStatus = document.getElementById(`clickStatus${index}`);
                if (clickStatus) {
                    clickStatus.textContent = 'üí∞ Ad Clicked';
                    clickStatus.style.background = 'rgba(156, 39, 176, 0.9)';
                }
                
                console.log(`üñ±Ô∏è Ad clicked for student ${index + 1}, opening: ${adUrl}`);
            };
            
            // Kattint√°s esem√©ny hozz√°ad√°sa a rekl√°mhoz
            playerContainer.addEventListener('click', adClickHandler);
            
            // 30 m√°sodperc ut√°n elt√°vol√≠tjuk a kezel≈ët, ha nem kattintottak
            setTimeout(() => {
                playerContainer.removeEventListener('click', adClickHandler);
            }, 30000);
        }

        // Rekl√°m statisztik√°k friss√≠t√©se
        function updateAdStats() {
            document.getElementById('totalAds').textContent = adStats.totalAds;
            document.getElementById('successfulAds').textContent = adStats.successfulAds;
            document.getElementById('adRevenue').textContent = adStats.estimatedRevenue.toFixed(2);
        }

        // ========== ALAP FUNKCI√ìK ==========

        // Update stats
        function updateStats() {
            document.getElementById('readyCount').textContent = playersReady;
            document.getElementById('activeCount').textContent = activePlayers;
            
            const progress = (playersReady / allYouTubeLinks.length) * 100;
            document.getElementById('loadProgress').style.width = progress + '%';
            
            document.getElementById('currentBatch').textContent = currentBatchIndex >= 0 ? batches[currentBatchIndex].name : '-';
        }

        // Timer friss√≠t√©se (√ºres manu√°lis m√≥dban)
        function updateTimer() {
            document.getElementById('timer').textContent = '--:--';
        }

        // Lej√°tsz√°si statisztik√°k friss√≠t√©se
        function updatePlaybackStats() {
            document.getElementById('playbackCount').textContent = `Total listening sessions: ${playbackStats.totalPlaybacks}`;
            
            let monthlyHTML = 'Monthly breakdown:<br>';
            const months = Object.keys(playbackStats.monthlyStats).sort().reverse();
            
            months.forEach(month => {
                monthlyHTML += `${month}: ${playbackStats.monthlyStats[month]} sessions<br>`;
            });
            
            document.getElementById('monthlyStats').innerHTML = monthlyHTML;
        }

        // Statisztik√°k bet√∂lt√©se localStorage-b√≥l
        function loadPlaybackStats() {
            const savedStats = localStorage.getItem('playbackStats');
            if (savedStats) {
                playbackStats = JSON.parse(savedStats);
            }
            updatePlaybackStats();
        }

        // Statisztik√°k ment√©se localStorage-ba
        function savePlaybackStats() {
            localStorage.setItem('playbackStats', JSON.stringify(playbackStats));
        }

        // Lej√°tsz√°s hozz√°ad√°sa a statisztik√°khoz
        function addPlayback(count) {
            playbackStats.totalPlaybacks += count;
            
            const now = new Date();
            const monthKey = `${now.getFullYear()} ${getMonthName(now.getMonth())}`;
            
            if (!playbackStats.monthlyStats[monthKey]) {
                playbackStats.monthlyStats[monthKey] = 0;
            }
            playbackStats.monthlyStats[monthKey] += count;
            
            updatePlaybackStats();
            savePlaybackStats();
        }

        // H√≥nap neve angolul
        function getMonthName(monthIndex) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[monthIndex];
        }

        // Batch bet√∂lt√©se - ASHBURN OPTIMALIZ√ÅLT
        function loadPlayersFromBatch(batch) {
            const videoGrid = document.getElementById('videoGrid');
            videoGrid.innerHTML = ''; // T√∂r√∂lj√ºk az el≈ëz≈ë batch sessionjait
            
            let currentIndex = batch.start;
            let errorCount = 0;
            const maxErrors = 15; // Cs√∂kkentve Ashburnhoz
            const promises = [];

            function loadNextPlayer() {
                if (currentIndex > batch.end) {
                    // Minden player bet√∂ltve
                    Promise.all(promises).then(() => {
                        isLoading = false;
                        document.getElementById('loadingMessage').style.display = 'none';
                        document.getElementById('statusMessage').innerHTML = `‚úÖ ${batch.name} loaded!<br>üéì Academy curriculum ready - 389 Students.`;
                        
                        updateStats();
                    });
                    return;
                }

                if (errorCount >= maxErrors) {
                    // T√∫l sok hiba
                    isLoading = false;
                    document.getElementById('loadingMessage').style.display = 'none';
                    document.getElementById('statusMessage').innerHTML = 
                        `‚ö†Ô∏è Academy loading stopped. ${playersReady}/${allYouTubeLinks.length} students loaded.<br>Try again!`;
                    updateStats();
                    return;
                }

                const videoId = allYouTubeLinks[currentIndex];
                const promise = createVideoPlayer(videoId, currentIndex);
                promises.push(promise);
                
                currentIndex++;
                // Ashburn optimaliz√°lt k√©sleltet√©s
                setTimeout(loadNextPlayer, FIREFOX_CONFIG.BATCH_LOAD_DELAY);
            }

            isLoading = true;
            document.getElementById('loadingMessage').style.display = 'block';
            document.getElementById('loadingMessage').textContent = 'Loading Academy curriculum for 389 students...';
            loadNextPlayer();
        }

        // Batch t√∂rl√©se a mem√≥ri√°b√≥l
        function clearBatch(batchIndex) {
            const batch = batches[batchIndex];
            
            for (let i = batch.start; i <= batch.end; i++) {
                const videoPlayer = document.getElementById(`videoPlayer${i}`);
                if (videoPlayer) {
                    videoPlayer.remove();
                }
                youtubePlayers[i] = null;
            }
            
            playersReady -= batch.size;
            updateStats();
        }

        // Dinamikus batch progress friss√≠t√©s
        function updateBatchProgress() {
            const container = document.getElementById('batchProgressContainer');
            container.innerHTML = '';
            
            batches.forEach((batch, index) => {
                const step = document.createElement('div');
                step.className = `batch-step ${index === currentBatchIndex ? 'active' : ''} ${index < currentBatchIndex ? 'completed' : ''}`;
                step.id = `batch${index + 1}Step`;
                
                step.innerHTML = `
                    <div>${batch.name}</div>
                    <div>(${batch.start + 1}-${batch.end + 1})</div>
                    <div style="font-size: 12px; margin-top: 5px;">${batch.size} students</div>
                `;
                
                container.appendChild(step);
            });
        }

        // Kock√°zat√©rt√©kel√©s
        function updateRiskAssessment() {
            const now = Date.now();
            const timeSinceUpdate = now - riskAssessment.lastUpdate;
            
            riskAssessment.patternScore = Math.max(0, riskAssessment.patternScore - (timeSinceUpdate / 60000));
            riskAssessment.timingScore = Math.max(0, riskAssessment.timingScore - (timeSinceUpdate / 60000));
            riskAssessment.behaviorScore = Math.max(0, riskAssessment.behaviorScore - (timeSinceUpdate / 60000));
            
            riskAssessment.totalScore = (
                riskAssessment.patternScore + 
                riskAssessment.timingScore + 
                riskAssessment.behaviorScore
            ) / 3;
            
            riskAssessment.lastUpdate = now;
            updateRiskDisplay();
        }

        function updateRiskDisplay() {
            const riskPercent = riskAssessment.totalScore * 100;
            const riskIndicator = document.getElementById('riskIndicator');
            const riskStatus = document.getElementById('riskStatus');
            
            riskIndicator.style.left = `${riskPercent}%`;
            
            let riskLevel = 'low';
            let riskText = '‚úÖ Educational Context Active - 389 Students - Standard Laptops - Classical Curriculum - Ashburn, VA Campus';
            let cardColor = 'safe';
            
            if (riskAssessment.totalScore > 0.8) {
                riskLevel = 'high';
                riskText = '‚ö†Ô∏è Attention - Check Academy performance';
                cardColor = 'danger';
            } else if (riskAssessment.totalScore > 0.6) {
                riskLevel = 'medium';
                riskText = '‚ÑπÔ∏è Normal risk - Academy stable';
                cardColor = 'warning';
            }
            
            riskStatus.textContent = riskText;
            document.getElementById('riskCard').className = `security-card ${cardColor}`;
            document.getElementById('riskCard').querySelector('div:last-child').textContent = 
                riskLevel === 'high' ? 'High' : riskLevel === 'medium' ? 'Medium' : 'Very Low';
        }

        // Minden le√°ll√≠t√°sa
        function stopAll() {
            if (gracefulShutdownActive) {
                stopGracefulShutdown();
            }
            
            if (currentBatchIndex >= 0) {
                const batch = batches[currentBatchIndex];
                const batchPlayers = youtubePlayers.slice(batch.start, batch.end + 1)
                    .filter(player => player !== undefined && player !== null);
                
                batchPlayers.forEach((player) => {
                    if (player && typeof player.stopVideo === 'function') {
                        try {
                            player.stopVideo();
                        } catch (e) {
                            console.log('Error stopping player:', e);
                        }
                    }
                });
            }
            
            activePlayers = 0;
            
            currentBatchIndex = -1;
            updateTimer();
            document.getElementById('timerLabel').textContent = 'Music Academy Mode - 389 Students - Classical Curriculum - Ashburn, VA Campus';
            updateStats();
            
            document.getElementById('statusMessage').innerHTML = '‚èπÔ∏è Everything stopped! Academy ready - 389 Students.';
            
            updateBatchProgress();
        }

        // K√∂vetkez≈ë batch bet√∂lt√©se
        function loadNextBatch() {
            if (currentBatchIndex >= 0) {
                clearBatch(currentBatchIndex);
            }
            
            currentBatchIndex++;
            
            if (currentBatchIndex >= batches.length) {
                // Ciklus befejez√©se
                cycleCount++;
                document.getElementById('statusMessage').innerHTML = 
                    `‚úÖ ${cycleCount}. Academy cycle completed! Total listening sessions: ${playbackStats.totalPlaybacks}`;
                
                document.getElementById('statusMessage').innerHTML += '<br>üîÑ Preparing new Academy cycle...';
                
                // Linkek kever√©se minden ciklus ut√°n
                shuffleYouTubeLinks();
                
                currentBatchIndex = -1;
                batches = generateDynamicBatches();
                updateBatchProgress();
                return;
            }
            
            const batch = batches[currentBatchIndex];
            document.getElementById('statusMessage').innerHTML = `Loading ${batch.name}...`;
            
            updateBatchProgress();
            loadPlayersFromBatch(batch);
        }

        // Els≈ë batch bet√∂lt√©se
        function loadFirstBatch() {
            if (currentBatchIndex >= 0) {
                clearBatch(currentBatchIndex);
            }
            
            currentBatchIndex = 0;
            const batch = batches[currentBatchIndex];
            document.getElementById('statusMessage').innerHTML = `Loading ${batch.name}...`;
            
            updateBatchProgress();
            loadPlayersFromBatch(batch);
        }

        // ========== MEM√ìRIA MONITOR FUNKCI√ìK - MANU√ÅLIS TISZT√çT√ÅS CSAK ==========

        // Mem√≥ria monitoroz√°s - CSAK MEGJELEN√çT√âS, NINCS AUTOMATIKUS TISZT√çT√ÅS
        function monitorMemory() {
            if (!memoryStats.monitoringActive) return;

            try {
                const memoryInfo = getMemoryInfo();
                updateMemoryDisplay(memoryInfo);
                
                // NINCS AUTOMATIKUS TISZT√çT√ÅS - CSAK MANU√ÅLIS
                // Csak riaszt√°st jelen√≠t√ºnk meg magas mem√≥riahaszn√°lat eset√©n
                if (memoryInfo.percent > 80) {
                    document.getElementById('cleanupAlert').style.display = 'block';
                    document.getElementById('cleanupAlert').textContent = 'üö® High memory usage! Manual cleanup recommended...';
                } else if (memoryInfo.percent > 60) {
                    document.getElementById('cleanupAlert').style.display = 'block';
                    document.getElementById('cleanupAlert').textContent = '‚ö†Ô∏è Moderate memory usage - monitor performance';
                } else {
                    document.getElementById('cleanupAlert').style.display = 'none';
                }
            } catch (error) {
                console.warn('Ashburn memory monitoring error:', error);
            }
        }

        // Mem√≥ria inform√°ci√≥k gy≈±jt√©se - ASHBURN KOMPATIBILIS
        function getMemoryInfo() {
            // Ashburn kompatibilis mem√≥ria monitoroz√°s
            if (performance.memory) {
                const memory = performance.memory;
                return {
                    used: Math.round(memory.usedJSHeapSize / (1024 * 1024)),
                    total: Math.round(memory.totalJSHeapSize / (1024 * 1024)),
                    limit: Math.round(memory.jsHeapSizeLimit / (1024 * 1024)),
                    percent: Math.round((memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100)
                };
            }
            
            // Ashburn fallback becsl√©s
            const estimatedUsed = Math.round((playersReady * 1.5) + (activePlayers * 3));
            const estimatedTotal = Math.max(estimatedUsed * 2, 100);
            
            return {
                used: estimatedUsed,
                total: estimatedTotal,
                limit: 512,
                percent: Math.min(100, Math.round((estimatedUsed / 512) * 100))
            };
        }

        // Mem√≥ria inform√°ci√≥k megjelen√≠t√©se
        function updateMemoryDisplay(memoryInfo) {
            document.getElementById('memoryUsage').textContent = `${memoryInfo.used} MB`;
            document.getElementById('memoryLimit').textContent = `${memoryInfo.limit} MB`;
            document.getElementById('memoryPercent').textContent = `${memoryInfo.percent}%`;
            document.getElementById('cleanupCount').textContent = memoryStats.cleanupCount;
            
            const memoryBar = document.getElementById('memoryBar');
            memoryBar.style.width = `${memoryInfo.percent}%`;
            
            if (memoryInfo.percent > 80) {
                memoryBar.style.background = 'linear-gradient(90deg, #ff9800, #f44336)';
            } else if (memoryInfo.percent > 60) {
                memoryBar.style.background = 'linear-gradient(90deg, #ffd93d, #ff9800)';
            } else {
                memoryBar.style.background = 'linear-gradient(90deg, #4CAF50, #ffd93d)';
            }
        }

        // MANU√ÅLIS mem√≥riatiszt√≠t√°s - ASHBURN OPTIMALIZ√ÅLT
        function performManualCleanup() {
            const cleanupAlert = document.getElementById('cleanupAlert');
            cleanupAlert.style.display = 'block';
            cleanupAlert.textContent = 'üßπ Manual memory cleanup in progress...';
            
            console.log(`üßπ Ashburn MANUAL memory cleanup starting`);
            
            // Ashburn optimaliz√°lt tiszt√≠t√°s
            if (currentBatchIndex >= 0) {
                const batch = batches[currentBatchIndex];
                const batchPlayers = youtubePlayers.slice(batch.start, batch.end + 1)
                    .filter(player => player !== undefined && player !== null);
                
                batchPlayers.forEach((player) => {
                    if (player && typeof player.stopVideo === 'function') {
                        try {
                            player.stopVideo();
                        } catch (e) {
                            console.log('Error stopping player:', e);
                        }
                    }
                });
            }
            
            const videoGrid = document.getElementById('videoGrid');
            videoGrid.innerHTML = '';
            
            // Ashburn mem√≥ria optimaliz√°l√°s
            if (currentBatchIndex >= 0) {
                const currentBatch = batches[currentBatchIndex];
                for (let i = 0; i < youtubePlayers.length; i++) {
                    if (i < currentBatch.start || i > currentBatch.end) {
                        youtubePlayers[i] = null;
                    }
                }
            } else {
                youtubePlayers = new Array(allYouTubeLinks.length);
            }
            
            forceGarbageCollection();
            
            const beforeMemory = getMemoryInfo().used;
            const afterMemory = getMemoryInfo().used;
            const memoryFreed = beforeMemory - afterMemory;
            
            memoryStats.cleanupCount++;
            memoryStats.lastCleanup = new Date();
            memoryStats.totalMemoryFreed += memoryFreed;
            
            setTimeout(() => {
                cleanupAlert.style.display = 'none';
            }, 5000);
            
            console.log(`‚úÖ Ashburn MANUAL cleanup completed: ${memoryFreed} MB memory freed`);
            document.getElementById('statusMessage').innerHTML = 
                `üßπ Ashburn MANUAL memory cleanup: ${memoryFreed} MB freed (${memoryStats.cleanupCount}. time)`;
        }

        // Szem√©tgy≈±jt√©s k√©nyszer√≠t√©se - ASHBURN KOMPATIBILIS
        function forceGarbageCollection() {
            // Ashburn kompatibilis GC
            if (window.gc) {
                window.gc();
            }
            
            try {
                // Ashburn optimaliz√°lt mem√≥riafelszabad√≠t√°s
                const tempArray = new Array(50000).fill(0);
                setTimeout(() => {
                    tempArray.length = 0;
                }, 100);
                
                return new Promise(resolve => {
                    setTimeout(resolve, 100);
                });
            } catch (error) {
                console.log('Ashburn GC forcing failed:', error);
            }
        }

        // K√©nyszer√≠tett manu√°lis tiszt√≠t√°s
        function forceManualCleanup() {
            document.getElementById('statusMessage').innerHTML = 'üßπ Ashburn MANUAL memory cleanup...';
            performManualCleanup();
        }

        // ========== UJJLENYOMAT GENER√ÅL√ÅS (ASHBURN) ==========

        // B√∂ng√©sz≈ë ujjlenyomat gener√°l√°sa Ashburn adatokkal
        function generateFingerprint() {
            const components = {
                userAgent: ASHBURN_USER_AGENTS[Math.floor(Math.random() * ASHBURN_USER_AGENTS.length)],
                language: 'en-US',
                languages: ['en-US'],
                platform: navigator.platform,
                hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
                deviceMemory: navigator.deviceMemory || 'unknown',
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                timezone: 'America/New_York',
                sessionStorage: !!window.sessionStorage,
                localStorage: !!window.localStorage,
                indexedDB: !!window.indexedDB,
                touchSupport: 'ontouchstart' in window,
                canvasFingerprint: generateCanvasFingerprint(),
                webglFingerprint: generateWebGLFingerprint(),
                audioFingerprint: generateAudioFingerprint(),
                plugins: getPluginsFingerprint(),
                fonts: getFontsFingerprint(),
                ipAddress: currentIP,
                country: 'United States',
                city: 'Ashburn, Virginia',
                institution: 'Crescendo Classical Music Academy',
                studentCount: 389,
                device: 'Standard Academy Laptop',
                purpose: 'Educational Listening',
                curriculum: 'Classical Music'
            };

            // Hash gener√°l√°sa a komponensekb≈ël
            const fingerprintString = JSON.stringify(components);
            const fingerprintHash = simpleHash(fingerprintString);
            
            fingerprintCount++;
            document.getElementById('fingerprintCount').textContent = fingerprintCount;
            
            return {
                hash: fingerprintHash,
                components: components,
                timestamp: Date.now(),
                location: 'Ashburn, Virginia Campus',
                institution: 'Crescendo Classical Music Academy',
                studentCount: 389,
                purpose: 'Educational'
            };
        }

        // Egyszer≈± hash f√ºggv√©ny
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        // Canvas fingerprint - Ashburn optimaliz√°lt
        function generateCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 200;
                canvas.height = 50;
                
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Ashburn Academy', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Ashburn Academy', 4, 17);
                
                return canvas.toDataURL();
            } catch (e) {
                return 'ashburn-error';
            }
        }

        // WebGL fingerprint - Ashburn kompatibilis
        function generateWebGLFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (!gl) return 'ashburn-no-webgl';
                
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                const vendor = gl.getParameter(debugInfo ? debugInfo.UNMASKED_VENDOR_WEBGL : gl.VENDOR);
                const renderer = gl.getParameter(debugInfo ? debugInfo.UNMASKED_RENDERER_WEBGL : gl.RENDERER);
                
                return `ashburn-${vendor}-${renderer}`;
            } catch (e) {
                return 'ashburn-error';
            }
        }

        // Audio fingerprint - Ashburn kompatibilis
        function generateAudioFingerprint() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const analyser = audioContext.createAnalyser();
                
                oscillator.connect(analyser);
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                
                const data = new Float32Array(analyser.frequencyBinCount);
                analyser.getFloatFrequencyData(data);
                
                return data.join(',');
            } catch (e) {
                return 'ashburn-error';
            }
        }

        // Plugin inform√°ci√≥k - Ashburn optimaliz√°lt
        function getPluginsFingerprint() {
            const plugins = [];
            for (let i = 0; i < navigator.plugins.length; i++) {
                plugins.push(navigator.plugins[i].name);
            }
            return plugins.join(',');
        }

        // Font inform√°ci√≥k
        function getFontsFingerprint() {
            const fonts = [
                'Arial', 'Arial Black', 'Arial Narrow', 'Times New Roman',
                'Courier New', 'Verdana', 'Comic Sans MS', 'Tahoma',
                'Trebuchet MS', 'Georgia', 'Palatino', 'Impact'
            ];
            
            const availableFonts = [];
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            fonts.forEach(font => {
                context.font = '72px ' + font + ', monospace';
                const text = 'abcdefghijklmnopqrstuvwxyz';
                const width1 = context.measureText(text).width;
                context.font = '72px monospace';
                const width2 = context.measureText(text).width;
                
                if (width1 !== width2) {
                    availableFonts.push(font);
                }
            });
            
            return availableFonts.join(',');
        }

        // Ujjlenyomat friss√≠t√©se minden session ind√≠t√°sakor
        function updateFingerprintForVideo(videoIndex) {
            currentFingerprint = generateFingerprint();
            
            // Ujjlenyomat inform√°ci√≥k megjelen√≠t√©se
            document.getElementById('fingerprintInfo').innerHTML = 
                `üîë Ashburn Student ${videoIndex + 1} fingerprint: ${currentFingerprint.hash.substring(0, 16)}...<br>
                 üéì Institution: ${currentFingerprint.components.institution}<br>
                 üìç Location: ${currentFingerprint.components.city}<br>
                 üë• Student Count: ${currentFingerprint.components.studentCount}`;
            
            console.log(`Ashburn fingerprint generated for student ${videoIndex + 1}:`, currentFingerprint);
        }

        // ========== ESEM√âNYKEZEL≈êK ==========

        // Popup bez√°r√°s gomb
        document.getElementById('closePopup').addEventListener('click', closeAdPopup);
        document.getElementById('popupOverlay').addEventListener('click', closeAdPopup);

        // Batch bet√∂lt√©s gomb
        document.getElementById('loadBatchButton').addEventListener('click', function() {
            loadFirstBatch();
        });

        // Graci√°lis le√°ll√≠t√°s gomb
        document.getElementById('gracefulShutdownButton').addEventListener('click', function() {
            startGracefulShutdown();
        });

        // K√∂vetkez≈ë batch bet√∂lt√©se gomb
        document.getElementById('nextBatchButton').addEventListener('click', function() {
            loadNextBatch();
        });

        // Le√°ll√≠t√°s gomb
        document.getElementById('stopButton').addEventListener('click', stopAll);

        // MANU√ÅLIS tiszt√≠t√°s gomb
        document.getElementById('manualCleanup').addEventListener('click', forceManualCleanup);

        // YouTube API bet√∂lt√©se
        function onYouTubeIframeAPIReady() {
            document.getElementById('statusMessage').textContent = 
                'üéì Crescendo Academy Student Portal Ready! 389 Students - Classical Music Curriculum - Standard Academy Laptops - Ashburn, Virginia Campus.';
            updateStats();
            updateTimer();
            loadPlaybackStats();
            updateBatchProgress();
            updateRiskAssessment();
            updateAdStats();
            initLinkEditor(); // Curriculum szerkeszt≈ë inicializ√°l√°sa
            
            // √öj funkci√≥k ind√≠t√°sa
            startErrorMonitoring();
            startHardwareSimulation();
            startAdvancedFingerprintRotation();
            
            // Ashburn optimaliz√°lt monitoroz√°s (CSAK MEGJELEN√çT√âS, NINCS AUTOMATIKUS TISZT√çT√ÅS)
            setInterval(monitorMemory, MEMORY_CONFIG.MONITOR_INTERVAL);
            
            // Performance monitor ind√≠t√°sa
            startPerformanceMonitor();
            
            // Ashburn v√©delmi rendszer ind√≠t√°sa
            startAdvancedProtection();
        }

        // Advanced fingerprint rotation ind√≠t√°sa
        function startAdvancedFingerprintRotation() {
            setInterval(() => {
                advancedFingerprintRotation();
            }, ADVANCED_PROTECTION_CONFIG.FINGERPRINT_ROTATION_INTERVAL);
        }

        // Oldal bet√∂lt√©sekor
        window.addEventListener('load', function() {
            // Linkek kever√©se minden oldalbet√∂lt√©skor
            shuffleYouTubeLinks();
            
            updateStats();
            updateBatchProgress();
            updateRiskAssessment();
            updateAdStats();
            
            // Ashburn optimaliz√°lt friss√≠t√©sek
            setInterval(() => {
                const patterns = ['Ashburn Academy', 'Educational', '389 Students', 'Standard Laptops'];
                const timings = ['Class Schedule', 'Curriculum', 'Daily Listening', 'Music Education'];
                const behaviors = ['Student Listening', 'Educational Use', 'Ashburn Context', 'Classical Music'];
                
                document.getElementById('patternCard').querySelector('div:last-child').textContent = 
                    patterns[Math.floor(Math.random() * patterns.length)];
                document.getElementById('timingCard').querySelector('div:last-child').textContent = 
                    timings[Math.floor(Math.random() * timings.length)];
                document.getElementById('behaviorCard').querySelector('div:last-child').textContent = 
                    behaviors[Math.floor(Math.random() * behaviors.length)];
            }, 10000);
            
            setInterval(updateRiskAssessment, 5000);
        });
    </script>
</body>
</html>
